<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>„ÅäÈáëÁÆ°ÁêÜ„Ç∑„Çπ„ÉÜ„É† v1.0</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
            font-size: 28px;
        }

        .input-section {
            background: #f7f9fc;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            color: #555;
            font-weight: 600;
            margin-bottom: 5px;
        }

        input, select {
            width: 100%;
            padding: 10px 15px;
            border: 2px solid #e0e6ed;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        button {
            flex: 1;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5a67d8;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #48bb78;
            color: white;
        }

        .btn-secondary:hover {
            background: #38a169;
        }

        .btn-danger {
            background: #f56565;
            color: white;
        }

        .btn-danger:hover {
            background: #e53e3e;
        }

        .records-section {
            margin-top: 30px;
        }

        .summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .summary-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .summary-card h3 {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 10px;
        }

        .summary-card p {
            font-size: 32px;
            font-weight: bold;
        }

        table {
            width: 100%;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.07);
        }

        th {
            background: #f7f9fc;
            padding: 15px;
            text-align: left;
            font-weight: 600;
            color: #555;
            border-bottom: 2px solid #e0e6ed;
        }

        td {
            padding: 15px;
            border-bottom: 1px solid #e0e6ed;
        }

        tr:hover {
            background: #f7f9fc;
        }

        .income {
            color: #48bb78;
            font-weight: 600;
        }

        .expense {
            color: #f56565;
            font-weight: 600;
        }

        .edit-btn, .delete-btn {
            padding: 5px 12px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            margin-right: 5px;
        }

        .edit-btn {
            background: #4299e1;
            color: white;
        }

        .delete-btn {
            background: #f56565;
            color: white;
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: #718096;
        }

        @media (max-width: 600px) {
            .container {
                padding: 20px;
            }

            h1 {
                font-size: 24px;
            }

            .summary-card p {
                font-size: 24px;
            }

            table {
                font-size: 14px;
            }

            th, td {
                padding: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üí∞ „ÅäÈáëÁÆ°ÁêÜ„Ç∑„Çπ„ÉÜ„É†</h1>
        
        <div class="input-section">
            <h2>ÂèéÊîØ„ÇíË®òÈå≤</h2>
            <form id="moneyForm">
                <input type="hidden" id="editId" value="">
                
                <div class="form-group">
                    <label for="type">Á®ÆÈ°û</label>
                    <select id="type" required>
                        <option value="income">ÂèéÂÖ•</option>
                        <option value="expense">ÊîØÂá∫</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="amount">ÈáëÈ°ç</label>
                    <input type="number" id="amount" placeholder="1000" required min="1">
                </div>
                
                <div class="form-group">
                    <label for="category">„Ç´„ÉÜ„Ç¥„É™„Éº</label>
                    <input type="text" id="category" placeholder="È£üË≤ª„ÄÅÁµ¶Êñô„Å™„Å©" required>
                </div>
                
                <div class="form-group">
                    <label for="date">Êó•‰ªò</label>
                    <input type="date" id="date" required>
                </div>
                
                <div class="form-group">
                    <label for="memo">„É°„É¢Ôºà‰ªªÊÑèÔºâ</label>
                    <input type="text" id="memo" placeholder="Ë©≥Á¥∞„Å™„Å©">
                </div>
                
                <div class="button-group">
                    <button type="submit" class="btn-primary">Ë®òÈå≤„Åô„Çã</button>
                    <button type="button" class="btn-secondary" onclick="exportCSV()">CSV„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ</button>
                    <button type="button" class="btn-danger" onclick="clearForm()">„ÇØ„É™„Ç¢</button>
                </div>
            </form>
        </div>
        
        <div class="records-section">
            <h2>ÂèéÊîØ„Çµ„Éû„É™„Éº</h2>
            <div class="summary">
                <div class="summary-card">
                    <h3>Á∑èÂèéÂÖ•</h3>
                    <p id="totalIncome">¬•0</p>
                </div>
                <div class="summary-card">
                    <h3>Á∑èÊîØÂá∫</h3>
                    <p id="totalExpense">¬•0</p>
                </div>
                <div class="summary-card">
                    <h3>ÊÆãÈ´ò</h3>
                    <p id="balance">¬•0</p>
                </div>
            </div>
            
            <h2>Ë®òÈå≤‰∏ÄË¶ß</h2>
            <div id="recordsContainer">
                <p class="empty-state">„Åæ„Å†Ë®òÈå≤„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</p>
            </div>
        </div>
    </div>

    <script>
        // „Éá„Éº„ÇøÁÆ°ÁêÜ
        let records = JSON.parse(localStorage.getItem('moneyRecords') || '[]');

        // ÂàùÊúüÂåñ
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('date').value = new Date().toISOString().split('T')[0];
            renderRecords();
            updateSummary();
        });

        // „Éï„Ç©„Éº„É†ÈÄÅ‰ø°
        document.getElementById('moneyForm').addEventListener('submit', (e) => {
            e.preventDefault();
            
            const editId = document.getElementById('editId').value;
            const formData = {
                id: editId || Date.now().toString(),
                type: document.getElementById('type').value,
                amount: parseInt(document.getElementById('amount').value),
                category: document.getElementById('category').value,
                date: document.getElementById('date').value,
                memo: document.getElementById('memo').value,
                createdAt: editId ? (records.find(r => r.id === editId)?.createdAt || new Date().toISOString()) : new Date().toISOString()
            };

            if (editId) {
                // Á∑®ÈõÜ„É¢„Éº„Éâ
                records = records.map(record => 
                    record.id === editId ? formData : record
                );
            } else {
                // Êñ∞Ë¶èËøΩÂä†
                records.push(formData);
            }

            saveRecords();
            clearForm();
            renderRecords();
            updateSummary();
        });

        // „É¨„Ç≥„Éº„ÉâË°®Á§∫
        function renderRecords() {
            const container = document.getElementById('recordsContainer');
            
            if (records.length === 0) {
                container.innerHTML = '<p class="empty-state">„Åæ„Å†Ë®òÈå≤„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</p>';
                return;
            }

            // Êó•‰ªò„Åß„ÇΩ„Éº„ÉàÔºàÊñ∞„Åó„ÅÑÈ†ÜÔºâ
            const sortedRecords = [...records].sort((a, b) => 
                new Date(b.date) - new Date(a.date)
            );

            const table = `
                <table>
                    <thead>
                        <tr>
                            <th>Êó•‰ªò</th>
                            <th>Á®ÆÈ°û</th>
                            <th>„Ç´„ÉÜ„Ç¥„É™„Éº</th>
                            <th>ÈáëÈ°ç</th>
                            <th>„É°„É¢</th>
                            <th>Êìç‰Ωú</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${sortedRecords.map(record => `
                            <tr>
                                <td>${formatDate(record.date)}</td>
                                <td class="${record.type}">${record.type === 'income' ? 'ÂèéÂÖ•' : 'ÊîØÂá∫'}</td>
                                <td>${record.category}</td>
                                <td class="${record.type}">¬•${record.amount.toLocaleString()}</td>
                                <td>${record.memo || '-'}</td>
                                <td>
                                    <button class="edit-btn" onclick="editRecord('${record.id}')">Á∑®ÈõÜ</button>
                                    <button class="delete-btn" onclick="deleteRecord('${record.id}')">ÂâäÈô§</button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;

            container.innerHTML = table;
        }

        // „Çµ„Éû„É™„ÉºÊõ¥Êñ∞
        function updateSummary() {
            const totalIncome = records
                .filter(r => r.type === 'income')
                .reduce((sum, r) => sum + r.amount, 0);
            
            const totalExpense = records
                .filter(r => r.type === 'expense')
                .reduce((sum, r) => sum + r.amount, 0);
            
            const balance = totalIncome - totalExpense;

            document.getElementById('totalIncome').textContent = `¬•${totalIncome.toLocaleString()}`;
            document.getElementById('totalExpense').textContent = `¬•${totalExpense.toLocaleString()}`;
            document.getElementById('balance').textContent = `¬•${balance.toLocaleString()}`;
        }

        // Á∑®ÈõÜ
        function editRecord(id) {
            const record = records.find(r => r.id === id);
            if (!record) return;

            document.getElementById('editId').value = record.id;
            document.getElementById('type').value = record.type;
            document.getElementById('amount').value = record.amount;
            document.getElementById('category').value = record.category;
            document.getElementById('date').value = record.date;
            document.getElementById('memo').value = record.memo;

            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // ÂâäÈô§
        function deleteRecord(id) {
            if (confirm('„Åì„ÅÆË®òÈå≤„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü')) {
                records = records.filter(r => r.id !== id);
                saveRecords();
                renderRecords();
                updateSummary();
            }
        }

        // CSVÂá∫Âäõ
        function exportCSV() {
            if (records.length === 0) {
                alert('„Ç®„ÇØ„Çπ„Éù„Éº„Éà„Åô„Çã„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì');
                return;
            }

            const headers = ['Êó•‰ªò', 'Á®ÆÈ°û', '„Ç´„ÉÜ„Ç¥„É™„Éº', 'ÈáëÈ°ç', '„É°„É¢', '‰ΩúÊàêÊó•ÊôÇ'];
            const rows = records.map(r => [
                r.date,
                r.type === 'income' ? 'ÂèéÂÖ•' : 'ÊîØÂá∫',
                r.category,
                r.amount,
                r.memo || '',
                r.createdAt
            ]);

            const csvContent = [
                headers.join(','),
                ...rows.map(row => row.map(cell => `"${cell}"`).join(','))
            ].join('\n');

            const blob = new Blob(['\uFEFF' + csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            
            link.setAttribute('href', url);
            link.setAttribute('download', `„ÅäÈáëÁÆ°ÁêÜ_${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // „Éï„Ç©„Éº„É†„ÇØ„É™„Ç¢
        function clearForm() {
            document.getElementById('editId').value = '';
            document.getElementById('moneyForm').reset();
            document.getElementById('date').value = new Date().toISOString().split('T')[0];
        }

        // „Éá„Éº„Çø‰øùÂ≠ò
        function saveRecords() {
            localStorage.setItem('moneyRecords', JSON.stringify(records));
        }

        // Êó•‰ªò„Éï„Ç©„Éº„Éû„ÉÉ„Éà
        function formatDate(dateStr) {
            const date = new Date(dateStr);
            return `${date.getFullYear()}/${(date.getMonth() + 1).toString().padStart(2, '0')}/${date.getDate().toString().padStart(2, '0')}`;
        }
    </script>
</body>
</html>