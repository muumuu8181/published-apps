# 要件定義書: 竹切りゲーム - 爽快斬撃体験

## 📋 基本情報
- **プロジェクト名**: ひたすら竹を竹ゲーム
- **実装名**: 竹切りゲーム - 爽快斬撃体験
- **アプリID**: app-0000006-bamb00
- **複雑度**: complex
- **開発日**: 2025-07-26

## 🎯 要求仕様

### 必須要件（高優先度）
1. **スワイプしたらスパッと切れる**
   ✅ 実装済み
   - マウス・タッチ両対応のスワイプ検出
   - ドラッグ軌跡の正確な追跡
   - スムーズなスライス処理
   - リアルタイム軌跡描画

2. **物理演算を頑張って、違和感ないところまで**
   ✅ 実装済み
   - 重力・摩擦・バウンス計算
   - 竹の自然な落下・回転
   - 切断時の力伝達
   - リアルな分離動作

3. **音(SE)も頑張って**
   ✅ 実装済み
   - Web Audio API使用
   - 切断音（Sawtooth波 + フィルター）
   - コンボ音（音程上昇）
   - エンベロープ処理

4. **斬っていてそう快感を目指して**
   ✅ 実装済み
   - パーティクルエフェクト
   - スライス軌跡のグロー効果
   - 即座の視覚・聴覚フィードバック
   - 爽快感を高める演出

5. **連続的にザクザク切りたい**
   ✅ 実装済み
   - コンボシステム（1秒以内連続）
   - 連続切りボーナスポイント
   - 視覚的コンボ表示
   - 中毒性のある仕組み

## 🚀 追加実装要件

### 技術面
- **PWA対応**: Progressive Web App として動作
- **単一ファイル**: 外部依存なしの完全自己完結
- **レスポンシブ**: 全デバイス対応
- **高精度判定**: 線分・矩形交差判定
- **パフォーマンス**: 60fps維持・メモリ最適化

### ゲーム要素
- **スコアシステム**: 基本点＋コンボボーナス
- **竹の自動生成**: 1.5秒間隔スポーン
- **画面外削除**: メモリリーク防止
- **エフェクト**: パーティクル・軌跡・アニメーション

## 📱 対応環境

### ブラウザ
- Chrome 80+
- Firefox 75+
- Safari 13+
- Edge 80+

### デバイス
- スマートフォン（Android/iOS）
- タブレット（Android/iPad）
- デスクトップPC（Windows/Mac/Linux）

### 入力方式
- マウス操作（ドラッグ）
- タッチ操作（スワイプ）
- ペン入力（対応デバイス）

## 🎨 ゲームデザイン

### 竹の表現
- **色彩**: HSL色空間でリアルな竹色
- **構造**: 節・ハイライトの表現
- **サイズ**: 幅60px、高さ120pxの統一規格
- **物理**: 重量感のある動作

### 視覚エフェクト
- **スライス軌跡**: 白いグロー効果
- **パーティクル**: 切断点からの破片飛散
- **アニメーション**: 滑らかな60fps動作
- **UI**: シンプルで直感的なスコア表示

### 音響設計
- **切断音**: 
  - 波形: Sawtooth（鋭い音質）
  - フィルター: Lowpass（自然な減衰）
  - 周波数: 800Hz（金属的響き）
- **コンボ音**:
  - 波形: Sine（純音）
  - 音程: コンボ数×50Hz上昇
  - 長さ: 0.2秒（短く爽快）

## ⚡ 技術仕様

### ゲームループ
- **フレームレート**: 60fps（requestAnimationFrame）
- **物理更新**: 全オブジェクトの位置・回転計算
- **描画**: Canvas完全再描画
- **最適化**: 画面外オブジェクト自動削除

### 物理演算
- **重力**: 0.5（適度な落下速度）
- **摩擦**: 0.99（空気抵抗）
- **バウンス**: 0.3（リアルな反発）
- **回転**: 切断時の角速度変化

### 入力処理
- **マウス**: mousedown、mousemove、mouseup
- **タッチ**: touchstart、touchmove、touchend
- **座標変換**: Canvas座標系への正確な変換
- **軌跡記録**: スライス判定用の座標配列

## 🎯 当たり判定

### アルゴリズム
- **線分・矩形交差**: 精密な数学的判定
- **スライス検出**: 軌跡と竹の境界box判定
- **分離位置**: 交差点での正確な分割
- **効率化**: 必要最小限の計算

### 判定精度
- **座標精度**: ピクセル単位
- **タイミング**: リアルタイム判定
- **誤検出防止**: 最小軌跡長による制御

## 🔧 パフォーマンス要件

### 応答性
- **入力遅延**: 16ms以内（1フレーム）
- **描画遅延**: 16ms以内（60fps維持）
- **音響遅延**: 10ms以内

### メモリ管理
- **オブジェクト削除**: 画面外で自動削除
- **パーティクル**: 寿命管理（1秒）
- **音響**: AudioContext再利用
- **メモリリーク**: 完全防止

## ✅ 受入基準

### 機能テスト
- [x] スワイプでの竹切断
- [x] 物理演算の自然さ
- [x] 音響エフェクトの品質
- [x] コンボシステムの動作
- [x] PWA機能

### 品質基準
- [x] 60fps維持
- [x] 入力応答性
- [x] メモリ効率
- [x] エラーハンドリング
- [x] ブラウザ互換性

### ユーザビリティ
- [x] 直感的操作
- [x] 爽快感
- [x] 中毒性
- [x] 視覚的魅力

## 📊 成功指標

### 定量的指標
- 要件達成度: 100%
- パフォーマンス: 60fps維持
- 応答遅延: 16ms以内
- メモリ使用量: 効率的

### 定性的指標
- 爽快感: 優秀
- 操作性: 直感的
- 音響品質: 高品質
- 中毒性: 高い