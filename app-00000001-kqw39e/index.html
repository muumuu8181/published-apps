<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÊßãÈÄ†ÂäõÂ≠¶„ÉªÂøúÂäõËß£Êûê„Ç∑„Éü„É•„É¨„Éº„Çø„Éº</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .main-content {
            background: white;
            border-radius: 15px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #e9ecef;
        }

        .tab {
            flex: 1;
            padding: 15px 20px;
            text-align: center;
            cursor: pointer;
            background: #f8f9fa;
            border: none;
            font-size: 14px;
            font-weight: 600;
            color: #6c757d;
            transition: all 0.3s;
        }

        .tab.active {
            background: white;
            color: #495057;
            border-bottom: 3px solid #007bff;
        }

        .tab:hover {
            background: #e9ecef;
        }

        .tab-content {
            display: none;
            padding: 25px;
            min-height: 600px;
        }

        .tab-content.active {
            display: block;
        }

        .control-panel {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .control-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .control-group label {
            font-weight: 600;
            color: #495057;
            font-size: 12px;
        }

        .control-group input, .control-group select {
            padding: 8px 12px;
            border: 2px solid #e9ecef;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .control-group input:focus, .control-group select:focus {
            outline: none;
            border-color: #007bff;
        }

        .btn {
            padding: 10px 20px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.3s;
        }

        .btn:hover {
            background: #0056b3;
        }

        .btn.secondary {
            background: #6c757d;
        }

        .btn.secondary:hover {
            background: #5a6268;
        }

        .btn.danger {
            background: #dc3545;
        }

        .btn.danger:hover {
            background: #c82333;
        }

        .canvas-container {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
        }

        .canvas-container canvas {
            display: block;
            cursor: crosshair;
        }

        .results-panel {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 15px;
        }

        .result-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .result-card h4 {
            color: #495057;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .result-value {
            font-size: 18px;
            font-weight: 700;
            color: #007bff;
        }

        .result-unit {
            font-size: 12px;
            color: #6c757d;
            margin-left: 5px;
        }

        .material-db {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .material-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border: 2px solid #e9ecef;
            cursor: pointer;
            transition: all 0.3s;
        }

        .material-card:hover {
            border-color: #007bff;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .material-card.selected {
            border-color: #007bff;
            background: #e3f2fd;
        }

        .chart-container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 2px solid #e9ecef;
        }

        .legend {
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
        }

        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 3px;
        }

        .stress-colorbar {
            display: flex;
            height: 20px;
            margin: 10px 0;
            border-radius: 10px;
            overflow: hidden;
        }

        .stress-level {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: 600;
            color: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.7);
        }

        .tutorial {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .tutorial h4 {
            color: #856404;
            margin-bottom: 10px;
        }

        .tutorial p {
            color: #856404;
            font-size: 14px;
            line-height: 1.5;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .tabs {
                flex-direction: column;
            }

            .control-row {
                flex-direction: column;
                align-items: stretch;
            }

            .canvas-container canvas {
                max-width: 100%;
                height: auto;
            }
        }

        .analysis-progress {
            background: #e9ecef;
            border-radius: 10px;
            height: 10px;
            margin: 15px 0;
            overflow: hidden;
        }

        .analysis-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #007bff, #28a745);
            border-radius: 10px;
            transition: width 0.3s;
            width: 0%;
        }

        .node-info, .element-info {
            position: absolute;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 8px;
            border-radius: 4px;
            font-size: 12px;
            pointer-events: none;
            z-index: 1000;
            display: none;
        }

        .calculation-steps {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
        }

        .error-message {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
            padding: 10px;
            border-radius: 6px;
            margin: 10px 0;
        }

        .success-message {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
            padding: 10px;
            border-radius: 6px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üèóÔ∏è ÊßãÈÄ†ÂäõÂ≠¶„ÉªÂøúÂäõËß£Êûê„Ç∑„Éü„É•„É¨„Éº„Çø„Éº</h1>
            <p>„Ç§„É≥„Çø„É©„ÇØ„ÉÜ„Ç£„Éñ„Å™ÊßãÈÄ†Ëß£Êûê„Å®„Éà„É©„Çπ„ÉªÊ¢Å„ÅÆÂøúÂäõË®àÁÆó„ÉÑ„Éº„É´</p>
        </div>

        <div class="main-content">
            <div class="tabs">
                <button class="tab active" data-tab="truss">„Éà„É©„ÇπËß£Êûê</button>
                <button class="tab" data-tab="beam">Ê¢Å„ÅÆËß£Êûê</button>
                <button class="tab" data-tab="materials">ÊùêÊñô„Éá„Éº„Çø„Éô„Éº„Çπ</button>
                <button class="tab" data-tab="learning">Â≠¶Áøí„É¢„Éº„Éâ</button>
                <button class="tab" data-tab="examples">‰æãÈ°åÈõÜ</button>
            </div>

            <!-- „Éà„É©„ÇπËß£Êûê„Çø„Éñ -->
            <div class="tab-content active" id="truss">
                <div class="tutorial">
                    <h4>üìö „Éà„É©„ÇπÊßãÈÄ†Ëß£Êûê</h4>
                    <p>ÁØÄÁÇπ„Çí„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶ÈÖçÁΩÆ„Åó„ÄÅÈÉ®Êùê„ÅßÊé•Á∂ö„Åó„Å¶„Éà„É©„ÇπÊßãÈÄ†„Çí‰ΩúÊàê„Åß„Åç„Åæ„Åô„ÄÇÂ¢ÉÁïåÊù°‰ª∂„Å®Ëç∑Èáç„ÇíË®≠ÂÆö„Åó„Å¶ÂøúÂäõËß£Êûê„ÇíÂÆüË°å„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ</p>
                </div>

                <div class="control-panel">
                    <div class="control-row">
                        <div class="control-group">
                            <label>Ëß£Êûê„É¢„Éº„Éâ</label>
                            <select id="analysisMode">
                                <option value="static">ÈùôÁöÑËß£Êûê</option>
                                <option value="modal">Âõ∫ÊúâÂÄ§Ëß£Êûê</option>
                            </select>
                        </div>
                        <div class="control-group">
                            <label>Ë°®Á§∫„É¢„Éº„Éâ</label>
                            <select id="displayMode">
                                <option value="structure">ÊßãÈÄ†Âõ≥</option>
                                <option value="stress">ÂøúÂäõÂàÜÂ∏É</option>
                                <option value="deformation">Â§âÂΩ¢Âõ≥</option>
                            </select>
                        </div>
                        <div class="control-group">
                            <label>Â§âÂΩ¢ÂÄçÁéá</label>
                            <input type="range" id="deformScale" min="1" max="100" value="10">
                            <span id="deformScaleValue">10x</span>
                        </div>
                    </div>
                    <div class="control-row">
                        <button class="btn" onclick="addNode()">ÁØÄÁÇπËøΩÂä†</button>
                        <button class="btn" onclick="addElement()">ÈÉ®ÊùêËøΩÂä†</button>
                        <button class="btn secondary" onclick="setSupport()">ÊîØÊåÅÊù°‰ª∂</button>
                        <button class="btn secondary" onclick="setLoad()">Ëç∑ÈáçË®≠ÂÆö</button>
                        <button class="btn" onclick="analyzeStructure()">Ëß£ÊûêÂÆüË°å</button>
                        <button class="btn danger" onclick="clearStructure()">„ÇØ„É™„Ç¢</button>
                    </div>
                </div>

                <div class="canvas-container">
                    <canvas id="trussCanvas" width="800" height="500"></canvas>
                    <div class="node-info" id="nodeInfo"></div>
                    <div class="element-info" id="elementInfo"></div>
                </div>

                <div class="analysis-progress">
                    <div class="analysis-progress-bar" id="progressBar"></div>
                </div>

                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background: #007bff;"></div>
                        <span>ÁØÄÁÇπ</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #28a745;"></div>
                        <span>ÈÉ®ÊùêÔºàÂúßÁ∏ÆÔºâ</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #dc3545;"></div>
                        <span>ÈÉ®ÊùêÔºàÂºïÂºµÔºâ</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #ffc107;"></div>
                        <span>ÊîØÊåÅÁÇπ</span>
                    </div>
                </div>

                <div class="results-panel">
                    <h3>Ëß£ÊûêÁµêÊûú</h3>
                    <div class="results-grid">
                        <div class="result-card">
                            <h4>ÊúÄÂ§ßÂøúÂäõ</h4>
                            <div class="result-value" id="maxStress">0<span class="result-unit">MPa</span></div>
                        </div>
                        <div class="result-card">
                            <h4>ÊúÄÂ§ßÂ§â‰Ωç</h4>
                            <div class="result-value" id="maxDisp">0<span class="result-unit">mm</span></div>
                        </div>
                        <div class="result-card">
                            <h4>ÂÆâÂÖ®‰øÇÊï∞</h4>
                            <div class="result-value" id="safetyFactor">‚àû<span class="result-unit">-</span></div>
                        </div>
                        <div class="result-card">
                            <h4>Á∑èÈáçÈáè</h4>
                            <div class="result-value" id="totalWeight">0<span class="result-unit">kg</span></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Ê¢Å„ÅÆËß£Êûê„Çø„Éñ -->
            <div class="tab-content" id="beam">
                <div class="tutorial">
                    <h4>üìö Ê¢Å„ÅÆÊõ≤„ÅíËß£Êûê</h4>
                    <p>Ê¢Å„ÅÆÈï∑„Åï„ÄÅÊîØÊåÅÊù°‰ª∂„ÄÅËç∑ÈáçÊù°‰ª∂„ÇíË®≠ÂÆö„Åó„Å¶„Åõ„ÇìÊñ≠ÂäõÂõ≥„ÉªÊõ≤„Åí„É¢„Éº„É°„É≥„ÉàÂõ≥„Çí‰ΩúÊàê„Åß„Åç„Åæ„Åô„ÄÇ</p>
                </div>

                <div class="control-panel">
                    <div class="control-row">
                        <div class="control-group">
                            <label>Ê¢Å„ÅÆÈï∑„Åï (m)</label>
                            <input type="number" id="beamLength" value="6" min="1" max="20" step="0.1">
                        </div>
                        <div class="control-group">
                            <label>Êñ≠Èù¢ÂΩ¢Áä∂</label>
                            <select id="beamSection">
                                <option value="rectangular">Áü©ÂΩ¢Êñ≠Èù¢</option>
                                <option value="circular">ÂÜÜÂΩ¢Êñ≠Èù¢</option>
                                <option value="i-beam">IÂΩ¢Êñ≠Èù¢</option>
                                <option value="h-beam">HÂΩ¢Êñ≠Èù¢</option>
                            </select>
                        </div>
                        <div class="control-group">
                            <label>ÊîØÊåÅÊù°‰ª∂</label>
                            <select id="supportType">
                                <option value="simple">ÂçòÁ¥îÊ¢Å</option>
                                <option value="cantilever">ÁâáÊåÅ„Å°Ê¢Å</option>
                                <option value="fixed">‰∏°Á´ØÂõ∫ÂÆöÊ¢Å</option>
                                <option value="continuous">ÈÄ£Á∂öÊ¢Å</option>
                            </select>
                        </div>
                    </div>
                    <div class="control-row">
                        <div class="control-group">
                            <label>Ëç∑Èáç„Çø„Ç§„Éó</label>
                            <select id="loadType">
                                <option value="point">ÈõÜ‰∏≠Ëç∑Èáç</option>
                                <option value="distributed">ÂàÜÂ∏ÉËç∑Èáç</option>
                                <option value="moment">„É¢„Éº„É°„É≥„ÉàËç∑Èáç</option>
                                <option value="triangular">‰∏âËßíÂΩ¢ÂàÜÂ∏ÉËç∑Èáç</option>
                            </select>
                        </div>
                        <div class="control-group">
                            <label>Ëç∑ÈáçÂÄ§ (kN)</label>
                            <input type="number" id="loadValue" value="10" min="0" max="1000" step="1">
                        </div>
                        <div class="control-group">
                            <label>Ëç∑Èáç‰ΩçÁΩÆ (m)</label>
                            <input type="number" id="loadPosition" value="3" min="0" max="20" step="0.1">
                        </div>
                    </div>
                    <div class="control-row">
                        <button class="btn" onclick="addBeamLoad()">Ëç∑ÈáçËøΩÂä†</button>
                        <button class="btn" onclick="analyzeBeam()">Ëß£ÊûêÂÆüË°å</button>
                        <button class="btn secondary" onclick="generateReport()">„É¨„Éù„Éº„ÉàÁîüÊàê</button>
                        <button class="btn danger" onclick="clearBeam()">„ÇØ„É™„Ç¢</button>
                    </div>
                </div>

                <div class="canvas-container">
                    <canvas id="beamCanvas" width="800" height="600"></canvas>
                </div>

                <div class="chart-container">
                    <h4>„Åõ„ÇìÊñ≠ÂäõÂõ≥ (SFD)</h4>
                    <canvas id="sfdCanvas" width="800" height="150"></canvas>
                </div>

                <div class="chart-container">
                    <h4>Êõ≤„Åí„É¢„Éº„É°„É≥„ÉàÂõ≥ (BMD)</h4>
                    <canvas id="bmdCanvas" width="800" height="150"></canvas>
                </div>

                <div class="chart-container">
                    <h4>„Åü„Çè„ÅøÂõ≥</h4>
                    <canvas id="deflectionCanvas" width="800" height="150"></canvas>
                </div>
            </div>

            <!-- ÊùêÊñô„Éá„Éº„Çø„Éô„Éº„Çπ„Çø„Éñ -->
            <div class="tab-content" id="materials">
                <div class="tutorial">
                    <h4>üìö ÊùêÊñô„Éá„Éº„Çø„Éô„Éº„Çπ</h4>
                    <p>ÂêÑÁ®ÆÊßãÈÄ†ÊùêÊñô„ÅÆÁâπÊÄßÂÄ§„ÇíÁ¢∫Ë™ç„Åó„ÄÅËß£Êûê„Å´‰ΩøÁî®„Åô„ÇãÊùêÊñô„ÇíÈÅ∏Êäû„Åß„Åç„Åæ„Åô„ÄÇ</p>
                </div>

                <div class="control-panel">
                    <div class="control-row">
                        <div class="control-group">
                            <label>ÊùêÊñô„Ç´„ÉÜ„Ç¥„É™</label>
                            <select id="materialCategory" onchange="filterMaterials()">
                                <option value="all">„Åô„Åπ„Å¶</option>
                                <option value="steel">ÈãºÊùê</option>
                                <option value="concrete">„Ç≥„É≥„ÇØ„É™„Éº„Éà</option>
                                <option value="wood">Êú®Êùê</option>
                                <option value="aluminum">„Ç¢„É´„Éü„Éã„Ç¶„É†</option>
                            </select>
                        </div>
                        <div class="control-group">
                            <label>Ê§úÁ¥¢</label>
                            <input type="text" id="materialSearch" placeholder="ÊùêÊñôÂêç„ÅßÊ§úÁ¥¢" oninput="filterMaterials()">
                        </div>
                    </div>
                </div>

                <div class="material-db" id="materialDatabase">
                    <!-- ÊùêÊñô„Ç´„Éº„Éâ„ÅåÂãïÁöÑ„Å´ÁîüÊàê„Åï„Çå„Çã -->
                </div>

                <div class="results-panel">
                    <h3>ÈÅ∏ÊäûÊùêÊñô„ÅÆË©≥Á¥∞</h3>
                    <div id="materialDetails">
                        <p>ÊùêÊñô„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</p>
                    </div>
                </div>
            </div>

            <!-- Â≠¶Áøí„É¢„Éº„Éâ„Çø„Éñ -->
            <div class="tab-content" id="learning">
                <div class="tutorial">
                    <h4>üìö ÊßãÈÄ†ÂäõÂ≠¶Â≠¶Áøí„É¢„Éº„Éâ</h4>
                    <p>Âü∫Êú¨ÁêÜË´ñ„Åã„ÇâÂøúÁî®„Åæ„Åß„ÄÅÊßãÈÄ†ÂäõÂ≠¶„ÅÆÊ¶ÇÂøµ„Çí„Ç§„É≥„Çø„É©„ÇØ„ÉÜ„Ç£„Éñ„Å´Â≠¶Áøí„Åß„Åç„Åæ„Åô„ÄÇ</p>
                </div>

                <div class="control-panel">
                    <div class="control-row">
                        <div class="control-group">
                            <label>Â≠¶Áøí„Éà„Éî„ÉÉ„ÇØ</label>
                            <select id="learningTopic" onchange="loadLearningContent()">
                                <option value="basics">Âü∫Êú¨Ê¶ÇÂøµ</option>
                                <option value="stress">ÂøúÂäõ„Å®„Å≤„Åö„Åø</option>
                                <option value="truss-theory">„Éà„É©„ÇπÁêÜË´ñ</option>
                                <option value="beam-theory">Ê¢ÅÁêÜË´ñ</option>
                                <option value="fem">ÊúâÈôêË¶ÅÁ¥†Ê≥ï</option>
                                <option value="safety">ÂÆâÂÖ®Ë®≠Ë®à</option>
                            </select>
                        </div>
                        <div class="control-group">
                            <label>Èõ£ÊòìÂ∫¶</label>
                            <select id="difficultyLevel">
                                <option value="beginner">ÂàùÁ¥ö</option>
                                <option value="intermediate">‰∏≠Á¥ö</option>
                                <option value="advanced">‰∏äÁ¥ö</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div id="learningContent">
                    <!-- Â≠¶Áøí„Ç≥„É≥„ÉÜ„É≥„ÉÑ„ÅåÂãïÁöÑ„Å´ÁîüÊàê„Åï„Çå„Çã -->
                </div>
            </div>

            <!-- ‰æãÈ°åÈõÜ„Çø„Éñ -->
            <div class="tab-content" id="examples">
                <div class="tutorial">
                    <h4>üìö ‰æãÈ°åÈõÜ</h4>
                    <p>ÂÆüË∑µÁöÑ„Å™‰æãÈ°å„ÇíÈÄö„Åó„Å¶ÊßãÈÄ†Ëß£Êûê„ÅÆÊâãÊ≥ï„ÇíÂ≠¶Áøí„Åß„Åç„Åæ„Åô„ÄÇ</p>
                </div>

                <div class="control-panel">
                    <div class="control-row">
                        <div class="control-group">
                            <label>‰æãÈ°å„Ç´„ÉÜ„Ç¥„É™</label>
                            <select id="exampleCategory" onchange="loadExamples()">
                                <option value="truss">„Éà„É©„ÇπÂïèÈ°å</option>
                                <option value="beam">Ê¢ÅÂïèÈ°å</option>
                                <option value="frame">„É©„Éº„É°„É≥ÂïèÈ°å</option>
                                <option value="practical">ÂÆüÂãôÂïèÈ°å</option>
                            </select>
                        </div>
                        <div class="control-group">
                            <label>Èõ£ÊòìÂ∫¶</label>
                            <select id="exampleDifficulty">
                                <option value="basic">Âü∫Êú¨</option>
                                <option value="standard">Ê®ôÊ∫ñ</option>
                                <option value="advanced">ÂøúÁî®</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div id="examplesList">
                    <!-- ‰æãÈ°å„É™„Çπ„Éà„ÅåÂãïÁöÑ„Å´ÁîüÊàê„Åï„Çå„Çã -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // „Ç∞„É≠„Éº„Éê„É´Â§âÊï∞
        let currentStructure = {
            nodes: [],
            elements: [],
            supports: [],
            loads: [],
            selectedMaterial: null
        };

        let currentBeam = {
            length: 6,
            section: 'rectangular',
            support: 'simple',
            loads: []
        };

        let isAnalyzing = false;
        let analysisResults = null;

        // ÊùêÊñô„Éá„Éº„Çø„Éô„Éº„Çπ
        const materialDatabase = [
            {
                id: 'ss400',
                name: 'SS400',
                category: 'steel',
                E: 200000, // MPa
                fy: 235,   // MPa
                density: 7850, // kg/m¬≥
                poisson: 0.3
            },
            {
                id: 'sm490',
                name: 'SM490',
                category: 'steel',
                E: 200000,
                fy: 325,
                density: 7850,
                poisson: 0.3
            },
            {
                id: 'fc21',
                name: 'FC21',
                category: 'concrete',
                E: 21000,
                fc: 21,
                density: 2300,
                poisson: 0.2
            },
            {
                id: 'hinoki',
                name: '„Éí„Éé„Ç≠',
                category: 'wood',
                E: 9000,
                fb: 32,
                density: 400,
                poisson: 0.3
            },
            {
                id: 'a6061',
                name: 'A6061-T6',
                category: 'aluminum',
                E: 70000,
                fy: 275,
                density: 2700,
                poisson: 0.33
            }
        ];

        // Â≠¶Áøí„Ç≥„É≥„ÉÜ„É≥„ÉÑ„Éá„Éº„Çø
        const learningContent = {
            basics: {
                title: 'ÊßãÈÄ†ÂäõÂ≠¶„ÅÆÂü∫Êú¨Ê¶ÇÂøµ',
                content: `
                    <h3>Âäõ„Å®„É¢„Éº„É°„É≥„Éà</h3>
                    <p>ÊßãÈÄ†ÂäõÂ≠¶„Åß„ÅØ„ÄÅÊßãÈÄ†Áâ©„Å´‰ΩúÁî®„Åô„ÇãÂäõ„Å®„É¢„Éº„É°„É≥„Éà„ÇíËß£Êûê„Åó„Åæ„Åô„ÄÇ</p>
                    <ul>
                        <li><strong>Âäõ (Force)</strong>: Áâ©‰Ωì„ÇíÂ§âÂΩ¢„Åï„Åõ„Åü„ÇäÈÅãÂãï„Åï„Åõ„Åü„Çä„Åô„Çã‰ΩúÁî® [N]</li>
                        <li><strong>„É¢„Éº„É°„É≥„Éà (Moment)</strong>: ÂõûËª¢„ÇíÁîü„Åò„Åï„Åõ„ÇãÂäõ„ÅÆ‰ΩúÁî® [N¬∑m]</li>
                        <li><strong>ÊîØÁÇπÂèçÂäõ</strong>: ÊîØÊåÅÁÇπ„ÅßÊßãÈÄ†Áâ©„ÇíÊîØ„Åà„ÇãÂäõ</li>
                    </ul>
                    
                    <h3>Âπ≥Ë°°Êù°‰ª∂</h3>
                    <p>ÈùôÁöÑÊßãÈÄ†Áâ©„Åß„ÅØ‰ª•‰∏ã„ÅÆÂπ≥Ë°°Êù°‰ª∂„ÇíÊ∫Ä„Åü„ÅôÂøÖË¶Å„Åå„ÅÇ„Çä„Åæ„ÅôÔºö</p>
                    <ul>
                        <li>Œ£Fx = 0 (Ê∞¥Âπ≥ÊñπÂêë„ÅÆÂäõ„ÅÆÈá£„ÇäÂêà„ÅÑ)</li>
                        <li>Œ£Fy = 0 (ÈâõÁõ¥ÊñπÂêë„ÅÆÂäõ„ÅÆÈá£„ÇäÂêà„ÅÑ)</li>
                        <li>Œ£M = 0 („É¢„Éº„É°„É≥„Éà„ÅÆÈá£„ÇäÂêà„ÅÑ)</li>
                    </ul>
                    
                    <div class="interactive-demo">
                        <canvas id="basicsDemo" width="400" height="200"></canvas>
                        <button onclick="demoBasics()">„Éá„É¢ÂÆüË°å</button>
                    </div>
                `
            },
            stress: {
                title: 'ÂøúÂäõ„Å®„Å≤„Åö„Åø',
                content: `
                    <h3>ÂøúÂäõ (Stress)</h3>
                    <p>ÊùêÊñôÂÜÖÈÉ®„ÅÆÂçò‰ΩçÈù¢Á©ç„ÅÇ„Åü„Çä„ÅÆÂÜÖÂäõ„ÇíÂøúÂäõ„Å®„ÅÑ„ÅÑ„Åæ„Åô„ÄÇ</p>
                    <ul>
                        <li><strong>Ëª∏ÂøúÂäõ</strong>: œÉ = P/A [MPa]</li>
                        <li><strong>Êõ≤„ÅíÂøúÂäõ</strong>: œÉ = M/Z [MPa]</li>
                        <li><strong>„Åõ„ÇìÊñ≠ÂøúÂäõ</strong>: œÑ = Q/A [MPa]</li>
                    </ul>
                    
                    <h3>„Å≤„Åö„Åø (Strain)</h3>
                    <p>ÊùêÊñô„ÅÆÂ§âÂΩ¢„ÅÆÁ®ãÂ∫¶„ÇíË°®„ÅôÁÑ°Ê¨°ÂÖÉÈáè„Åß„Åô„ÄÇ</p>
                    <ul>
                        <li><strong>Ëª∏„Å≤„Åö„Åø</strong>: Œµ = Œ¥/L [-]</li>
                        <li><strong>„Åõ„ÇìÊñ≠„Å≤„Åö„Åø</strong>: Œ≥ = Œ∏ [rad]</li>
                    </ul>
                    
                    <h3>„Éï„ÉÉ„ÇØ„ÅÆÊ≥ïÂâá</h3>
                    <p>ÂøúÂäõ„Å®„Å≤„Åö„Åø„ÅÆÈñ¢‰øÇ: œÉ = E¬∑Œµ</p>
                    <p>E: ÂºæÊÄß‰øÇÊï∞ („É§„É≥„Ç∞Áéá) [MPa]</p>
                `
            }
        };

        // ‰æãÈ°å„Éá„Éº„Çø
        const exampleProblems = {
            truss: [
                {
                    id: 'truss_01',
                    title: 'ÂçòÁ¥î„Éà„É©„Çπ - Âü∫Êú¨ÂïèÈ°å',
                    difficulty: 'basic',
                    description: '3ÁØÄÁÇπ2ÈÉ®Êùê„ÅÆÊúÄ„ÇÇÂü∫Êú¨ÁöÑ„Å™„Éà„É©„ÇπÊßãÈÄ†„ÅÆËß£Êûê',
                    solution: 'ÊîØÁÇπÂèçÂäõ: Ay=5kN, By=5kN\nÈÉ®ÊùêËª∏Âäõ: N1=7.07kN(T), N2=7.07kN(T)'
                },
                {
                    id: 'truss_02',
                    title: '„ÉØ„Éº„É¨„É≥„Éà„É©„Çπ',
                    difficulty: 'standard',
                    description: 'Ê©ãÊ¢Å„Åß„Çà„Åè‰ΩøÁî®„Åï„Çå„ÇãÂπ≥Ë°åÂº¶„Éà„É©„Çπ„ÅÆËß£Êûê',
                    solution: '‰∏äÂº¶Êùê„ÅØÂúßÁ∏Æ„ÄÅ‰∏ãÂº¶Êùê„ÅØÂºïÂºµ„ÄÅÊñúÊùê„ÉªÂûÇÁõ¥Êùê„ÅÆËª∏Âäõ„ÇíÁÆóÂá∫'
                }
            ],
            beam: [
                {
                    id: 'beam_01',
                    title: 'ÂçòÁ¥îÊ¢Å - ÈõÜ‰∏≠Ëç∑Èáç',
                    difficulty: 'basic',
                    description: '‰∏≠Â§Æ„Å´ÈõÜ‰∏≠Ëç∑Èáç„Åå‰ΩúÁî®„Åô„ÇãÂçòÁ¥îÊ¢Å',
                    solution: 'Mmax = PL/4, Œ¥max = PL¬≥/(48EI)'
                },
                {
                    id: 'beam_02',
                    title: 'ÁâáÊåÅ„Å°Ê¢Å - ÂàÜÂ∏ÉËç∑Èáç',
                    difficulty: 'standard',
                    description: 'Á≠âÂàÜÂ∏ÉËç∑Èáç„Åå‰ΩúÁî®„Åô„ÇãÁâáÊåÅ„Å°Ê¢Å',
                    solution: 'Mmax = wL¬≤/2, Œ¥max = wL‚Å¥/(8EI)'
                }
            ]
        };

        // ÂàùÊúüÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            initializeTabs();
            initializeCanvases();
            loadMaterials();
            loadLearningContent();
            loadExamples();
            
            // „Éá„Éï„Ç©„É´„ÉàÊùêÊñôË®≠ÂÆö
            currentStructure.selectedMaterial = materialDatabase[0];
        });

        // „Çø„ÉñÊ©üËÉΩ
        function initializeTabs() {
            const tabs = document.querySelectorAll('.tab');
            const tabContents = document.querySelectorAll('.tab-content');

            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    // „Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Çø„Éñ„ÇíÂàá„ÇäÊõø„Åà
                    tabs.forEach(t => t.classList.remove('active'));
                    tabContents.forEach(tc => tc.classList.remove('active'));
                    
                    tab.classList.add('active');
                    document.getElementById(tab.dataset.tab).classList.add('active');
                });
            });
        }

        // „Ç≠„É£„É≥„Éê„ÇπÂàùÊúüÂåñ
        function initializeCanvases() {
            const trussCanvas = document.getElementById('trussCanvas');
            const beamCanvas = document.getElementById('beamCanvas');
            
            if (trussCanvas) {
                trussCanvas.addEventListener('click', handleTrussCanvasClick);
                trussCanvas.addEventListener('mousemove', handleTrussCanvasHover);
                drawTrussGrid(trussCanvas);
            }
            
            if (beamCanvas) {
                drawBeamStructure();
            }

            // Â§âÂΩ¢ÂÄçÁéá„Çπ„É©„Ç§„ÉÄ„Éº
            const deformScale = document.getElementById('deformScale');
            if (deformScale) {
                deformScale.addEventListener('input', (e) => {
                    document.getElementById('deformScaleValue').textContent = e.target.value + 'x';
                    if (analysisResults) {
                        drawTrussResults();
                    }
                });
            }
        }

        // „Éà„É©„ÇπÊßãÈÄ†„ÅÆÊèèÁîª
        function drawTrussGrid(canvas) {
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // „Ç∞„É™„ÉÉ„ÉâÊèèÁîª
            ctx.strokeStyle = '#e9ecef';
            ctx.lineWidth = 1;
            
            for (let x = 0; x <= canvas.width; x += 40) {
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, canvas.height);
                ctx.stroke();
            }
            
            for (let y = 0; y <= canvas.height; y += 40) {
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(canvas.width, y);
                ctx.stroke();
            }
            
            drawTrussStructure();
        }

        function drawTrussStructure() {
            const canvas = document.getElementById('trussCanvas');
            const ctx = canvas.getContext('2d');
            
            // ÈÉ®Êùê„ÇíÊèèÁîª
            currentStructure.elements.forEach((element, index) => {
                const node1 = currentStructure.nodes[element.node1];
                const node2 = currentStructure.nodes[element.node2];
                
                if (node1 && node2) {
                    ctx.beginPath();
                    ctx.moveTo(node1.x, node1.y);
                    ctx.lineTo(node2.x, node2.y);
                    
                    // ÂøúÂäõ„Å´„Çà„ÇãËâ≤ÂàÜ„Åë
                    if (analysisResults && analysisResults.elementStresses[index] !== undefined) {
                        const stress = analysisResults.elementStresses[index];
                        if (stress > 0) {
                            ctx.strokeStyle = '#dc3545'; // ÂºïÂºµÔºàËµ§Ôºâ
                        } else {
                            ctx.strokeStyle = '#28a745'; // ÂúßÁ∏ÆÔºàÁ∑ëÔºâ
                        }
                        ctx.lineWidth = Math.max(2, Math.abs(stress) / 10);
                    } else {
                        ctx.strokeStyle = '#6c757d';
                        ctx.lineWidth = 2;
                    }
                    
                    ctx.stroke();
                    
                    // ÈÉ®ÊùêÁï™Âè∑Ë°®Á§∫
                    const midX = (node1.x + node2.x) / 2;
                    const midY = (node1.y + node2.y) / 2;
                    ctx.fillStyle = '#495057';
                    ctx.font = '12px Arial';
                    ctx.fillText(`E${index}`, midX + 5, midY - 5);
                }
            });
            
            // ÁØÄÁÇπ„ÇíÊèèÁîª
            currentStructure.nodes.forEach((node, index) => {
                ctx.beginPath();
                ctx.arc(node.x, node.y, 6, 0, 2 * Math.PI);
                
                // ÊîØÊåÅÊù°‰ª∂„Å´„Çà„ÇãËâ≤ÂàÜ„Åë
                const support = currentStructure.supports.find(s => s.node === index);
                if (support) {
                    ctx.fillStyle = '#ffc107'; // ÊîØÊåÅÁÇπÔºàÈªÑÔºâ
                } else {
                    ctx.fillStyle = '#007bff'; // Ëá™Áî±ÁØÄÁÇπÔºàÈùíÔºâ
                }
                
                ctx.fill();
                ctx.strokeStyle = '#343a40';
                ctx.lineWidth = 2;
                ctx.stroke();
                
                // ÁØÄÁÇπÁï™Âè∑Ë°®Á§∫
                ctx.fillStyle = '#495057';
                ctx.font = '12px Arial';
                ctx.fillText(`N${index}`, node.x + 10, node.y - 10);
                
                // Â§â‰ΩçË°®Á§∫
                if (analysisResults && analysisResults.nodeDisplacements[index]) {
                    const disp = analysisResults.nodeDisplacements[index];
                    const scale = document.getElementById('deformScale').value / 10;
                    const dispX = disp.x * scale;
                    const dispY = disp.y * scale;
                    
                    ctx.beginPath();
                    ctx.setLineDash([5, 5]);
                    ctx.moveTo(node.x, node.y);
                    ctx.lineTo(node.x + dispX, node.y + dispY);
                    ctx.strokeStyle = '#e74c3c';
                    ctx.lineWidth = 2;
                    ctx.stroke();
                    ctx.setLineDash([]);
                }
            });
            
            // Ëç∑Èáç„ÇíÊèèÁîª
            currentStructure.loads.forEach(load => {
                const node = currentStructure.nodes[load.node];
                if (node) {
                    drawLoadArrow(ctx, node.x, node.y, load.fx, load.fy);
                }
            });
        }

        function drawLoadArrow(ctx, x, y, fx, fy) {
            const scale = 0.1; // Ëç∑ÈáçË°®Á§∫„Çπ„Ç±„Éº„É´
            const arrowX = fx * scale;
            const arrowY = fy * scale;
            
            ctx.beginPath();
            ctx.moveTo(x, y);
            ctx.lineTo(x + arrowX, y + arrowY);
            ctx.strokeStyle = '#e74c3c';
            ctx.lineWidth = 3;
            ctx.stroke();
            
            // Áü¢Âç∞„ÅÆÈ†≠
            const angle = Math.atan2(arrowY, arrowX);
            const headlen = 10;
            
            ctx.beginPath();
            ctx.moveTo(x + arrowX, y + arrowY);
            ctx.lineTo(x + arrowX - headlen * Math.cos(angle - Math.PI/6),
                      y + arrowY - headlen * Math.sin(angle - Math.PI/6));
            ctx.moveTo(x + arrowX, y + arrowY);
            ctx.lineTo(x + arrowX - headlen * Math.cos(angle + Math.PI/6),
                      y + arrowY - headlen * Math.sin(angle + Math.PI/6));
            ctx.stroke();
        }

        // „Éà„É©„ÇπËß£ÊûêÈñ¢Êï∞
        function addNode() {
            // Ê¨°„ÅÆÁ©∫„ÅÑ„Å¶„ÅÑ„Çã‰ΩçÁΩÆ„Å´ÁØÄÁÇπ„ÇíËøΩÂä†
            const canvas = document.getElementById('trussCanvas');
            const rect = canvas.getBoundingClientRect();
            const x = 100 + (currentStructure.nodes.length % 8) * 80;
            const y = 200 + Math.floor(currentStructure.nodes.length / 8) * 80;
            
            currentStructure.nodes.push({x, y});
            drawTrussGrid(canvas);
        }

        function addElement() {
            if (currentStructure.nodes.length < 2) {
                showMessage('ÈÉ®Êùê„ÇíËøΩÂä†„Åô„Çã„Å´„ÅØÂ∞ë„Å™„Åè„Å®„ÇÇ2„Å§„ÅÆÁØÄÁÇπ„ÅåÂøÖË¶Å„Åß„Åô„ÄÇ', 'error');
                return;
            }
            
            // ÊúÄÂæå„ÅÆ2„Å§„ÅÆÁØÄÁÇπ„ÇíÊé•Á∂ö
            const nodeCount = currentStructure.nodes.length;
            currentStructure.elements.push({
                node1: nodeCount - 2,
                node2: nodeCount - 1,
                area: 0.01, // m¬≤
                material: currentStructure.selectedMaterial
            });
            
            drawTrussGrid(document.getElementById('trussCanvas'));
        }

        function setSupport() {
            if (currentStructure.nodes.length === 0) {
                showMessage('ÊîØÊåÅÊù°‰ª∂„ÇíË®≠ÂÆö„Åô„Çã„Å´„ÅØÁØÄÁÇπ„ÅåÂøÖË¶Å„Åß„Åô„ÄÇ', 'error');
                return;
            }
            
            // ÊúÄÂàù„ÅÆÁØÄÁÇπ„Çí„Éî„É≥ÊîØÊåÅ„ÄÅ2Áï™ÁõÆ„Çí„É≠„Éº„É©„ÉºÊîØÊåÅ„Å´Ë®≠ÂÆö
            currentStructure.supports = [
                {node: 0, type: 'pin', ux: true, uy: true},
                {node: 1, type: 'roller', ux: false, uy: true}
            ];
            
            drawTrussGrid(document.getElementById('trussCanvas'));
        }

        function setLoad() {
            if (currentStructure.nodes.length === 0) {
                showMessage('Ëç∑Èáç„ÇíË®≠ÂÆö„Åô„Çã„Å´„ÅØÁØÄÁÇπ„ÅåÂøÖË¶Å„Åß„Åô„ÄÇ', 'error');
                return;
            }
            
            // ÊúÄÂæå„ÅÆÁØÄÁÇπ„Å´‰∏ãÂêë„ÅçËç∑Èáç„ÇíË®≠ÂÆö
            const lastNode = currentStructure.nodes.length - 1;
            currentStructure.loads.push({
                node: lastNode,
                fx: 0,
                fy: -10000 // N
            });
            
            drawTrussGrid(document.getElementById('trussCanvas'));
        }

        function analyzeStructure() {
            if (currentStructure.nodes.length < 2 || currentStructure.elements.length === 0) {
                showMessage('Ëß£Êûê„Å´„ÅØÂ∞ë„Å™„Åè„Å®„ÇÇ2„Å§„ÅÆÁØÄÁÇπ„Å®1„Å§„ÅÆÈÉ®Êùê„ÅåÂøÖË¶Å„Åß„Åô„ÄÇ', 'error');
                return;
            }
            
            if (currentStructure.supports.length === 0) {
                showMessage('ÊîØÊåÅÊù°‰ª∂„ÇíË®≠ÂÆö„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ', 'error');
                return;
            }
            
            showAnalysisProgress();
            
            setTimeout(() => {
                try {
                    analysisResults = performStructuralAnalysis();
                    updateAnalysisResults();
                    drawTrussResults();
                    showMessage('Ëß£Êûê„ÅåÂÆå‰∫Ü„Åó„Åæ„Åó„Åü„ÄÇ', 'success');
                } catch (error) {
                    showMessage('Ëß£Êûê„Ç®„É©„Éº: ' + error.message, 'error');
                }
                hideAnalysisProgress();
            }, 1000);
        }

        function performStructuralAnalysis() {
            const nodeCount = currentStructure.nodes.length;
            const dofCount = nodeCount * 2; // 2 DOF per node
            
            // ÂÖ®‰ΩìÂâõÊÄß„Éû„Éà„É™„ÉÉ„ÇØ„Çπ„ÅÆÂàùÊúüÂåñ
            const K = Array(dofCount).fill().map(() => Array(dofCount).fill(0));
            
            // ÈÉ®ÊùêÂâõÊÄß„Éû„Éà„É™„ÉÉ„ÇØ„Çπ„ÅÆÁµÑ„ÅøÁ´ã„Å¶
            currentStructure.elements.forEach(element => {
                const node1 = currentStructure.nodes[element.node1];
                const node2 = currentStructure.nodes[element.node2];
                
                const L = Math.sqrt(Math.pow(node2.x - node1.x, 2) + Math.pow(node2.y - node1.y, 2)) / 1000; // mm to m
                const cos = (node2.x - node1.x) / (L * 1000);
                const sin = (node2.y - node1.y) / (L * 1000);
                
                const E = element.material.E * 1e6; // MPa to Pa
                const A = element.area; // m¬≤
                const k = E * A / L;
                
                // ÈÉ®ÊùêÂ∫ßÊ®ôÁ≥ª„Åã„ÇâÂÖ®‰ΩìÂ∫ßÊ®ôÁ≥ª„Å∏„ÅÆÂ§âÊèõ„Éû„Éà„É™„ÉÉ„ÇØ„Çπ
                const T = [
                    [cos, sin, 0, 0],
                    [-sin, cos, 0, 0],
                    [0, 0, cos, sin],
                    [0, 0, -sin, cos]
                ];
                
                // ÈÉ®ÊùêÂâõÊÄß„Éû„Éà„É™„ÉÉ„ÇØ„ÇπÔºàÂÖ®‰ΩìÂ∫ßÊ®ôÁ≥ªÔºâ
                const ke = [
                    [k * cos * cos, k * cos * sin, -k * cos * cos, -k * cos * sin],
                    [k * cos * sin, k * sin * sin, -k * cos * sin, -k * sin * sin],
                    [-k * cos * cos, -k * cos * sin, k * cos * cos, k * cos * sin],
                    [-k * cos * sin, -k * sin * sin, k * cos * sin, k * sin * sin]
                ];
                
                // ÂÖ®‰ΩìÂâõÊÄß„Éû„Éà„É™„ÉÉ„ÇØ„Çπ„Å∏„ÅÆÁµÑ„ÅøËæº„Åø
                for (let i = 0; i < 2; i++) {
                    for (let j = 0; j < 2; j++) {
                        K[element.node1 * 2 + i][element.node1 * 2 + j] += ke[i][j];
                        K[element.node1 * 2 + i][element.node2 * 2 + j] += ke[i][j + 2];
                        K[element.node2 * 2 + i][element.node1 * 2 + j] += ke[i + 2][j];
                        K[element.node2 * 2 + i][element.node2 * 2 + j] += ke[i + 2][j + 2];
                    }
                }
            });
            
            // Ëç∑Èáç„Éô„ÇØ„Éà„É´„ÅÆÁµÑ„ÅøÁ´ã„Å¶
            const F = Array(dofCount).fill(0);
            currentStructure.loads.forEach(load => {
                F[load.node * 2] += load.fx;
                F[load.node * 2 + 1] += load.fy;
            });
            
            // Â¢ÉÁïåÊù°‰ª∂„ÅÆÈÅ©Áî®
            currentStructure.supports.forEach(support => {
                if (support.ux) {
                    // XÊñπÂêëÊãòÊùü
                    const dof = support.node * 2;
                    for (let i = 0; i < dofCount; i++) {
                        K[dof][i] = 0;
                        K[i][dof] = 0;
                    }
                    K[dof][dof] = 1;
                    F[dof] = 0;
                }
                if (support.uy) {
                    // YÊñπÂêëÊãòÊùü
                    const dof = support.node * 2 + 1;
                    for (let i = 0; i < dofCount; i++) {
                        K[dof][i] = 0;
                        K[i][dof] = 0;
                    }
                    K[dof][dof] = 1;
                    F[dof] = 0;
                }
            });
            
            // ÈÄ£Á´ãÊñπÁ®ãÂºè„ÅÆÊ±ÇËß£Ôºà„Ç¨„Ç¶„ÇπÊ∂àÂéªÊ≥ïÔºâ
            const displacements = solveLinearSystem(K, F);
            
            // ÁØÄÁÇπÂ§â‰Ωç„ÅÆÊï¥ÁêÜ
            const nodeDisplacements = [];
            for (let i = 0; i < nodeCount; i++) {
                nodeDisplacements.push({
                    x: displacements[i * 2] * 1000,     // m to mm
                    y: displacements[i * 2 + 1] * 1000  // m to mm
                });
            }
            
            // ÈÉ®ÊùêÂøúÂäõ„ÅÆË®àÁÆó
            const elementStresses = [];
            currentStructure.elements.forEach((element, index) => {
                const node1 = currentStructure.nodes[element.node1];
                const node2 = currentStructure.nodes[element.node2];
                
                const L = Math.sqrt(Math.pow(node2.x - node1.x, 2) + Math.pow(node2.y - node1.y, 2)) / 1000;
                const cos = (node2.x - node1.x) / (L * 1000);
                const sin = (node2.y - node1.y) / (L * 1000);
                
                const u1x = displacements[element.node1 * 2];
                const u1y = displacements[element.node1 * 2 + 1];
                const u2x = displacements[element.node2 * 2];
                const u2y = displacements[element.node2 * 2 + 1];
                
                const deltaL = cos * (u2x - u1x) + sin * (u2y - u1y);
                const strain = deltaL / L;
                const stress = element.material.E * 1e6 * strain / 1e6; // MPa
                
                elementStresses.push(stress);
            });
            
            return {
                nodeDisplacements,
                elementStresses,
                maxStress: Math.max(...elementStresses.map(Math.abs)),
                maxDisplacement: Math.max(...nodeDisplacements.map(d => Math.sqrt(d.x*d.x + d.y*d.y)))
            };
        }

        function solveLinearSystem(A, b) {
            const n = A.length;
            const x = [...b];
            
            // „Ç¨„Ç¶„ÇπÊ∂àÂéªÊ≥ï
            for (let i = 0; i < n; i++) {
                // „Éî„Éú„ÉÉ„ÉàÈÅ∏Êäû
                let maxRow = i;
                for (let k = i + 1; k < n; k++) {
                    if (Math.abs(A[k][i]) > Math.abs(A[maxRow][i])) {
                        maxRow = k;
                    }
                }
                
                // Ë°å‰∫§Êèõ
                [A[i], A[maxRow]] = [A[maxRow], A[i]];
                [x[i], x[maxRow]] = [x[maxRow], x[i]];
                
                // ÂâçÈÄ≤Ê∂àÂéª
                for (let k = i + 1; k < n; k++) {
                    const factor = A[k][i] / A[i][i];
                    for (let j = i; j < n; j++) {
                        A[k][j] -= factor * A[i][j];
                    }
                    x[k] -= factor * x[i];
                }
            }
            
            // ÂæåÈÄÄ‰ª£ÂÖ•
            for (let i = n - 1; i >= 0; i--) {
                for (let k = i + 1; k < n; k++) {
                    x[i] -= A[i][k] * x[k];
                }
                x[i] /= A[i][i];
            }
            
            return x;
        }

        function drawTrussResults() {
            drawTrussStructure();
        }

        function updateAnalysisResults() {
            if (!analysisResults) return;
            
            document.getElementById('maxStress').textContent = 
                analysisResults.maxStress.toFixed(2);
            document.getElementById('maxDisp').textContent = 
                analysisResults.maxDisplacement.toFixed(3);
            
            const safetyFactor = currentStructure.selectedMaterial.fy / analysisResults.maxStress;
            document.getElementById('safetyFactor').textContent = 
                safetyFactor.toFixed(2);
            
            // Á∑èÈáçÈáèË®àÁÆó
            let totalWeight = 0;
            currentStructure.elements.forEach(element => {
                const node1 = currentStructure.nodes[element.node1];
                const node2 = currentStructure.nodes[element.node2];
                const length = Math.sqrt(Math.pow(node2.x - node1.x, 2) + Math.pow(node2.y - node1.y, 2)) / 1000;
                totalWeight += element.area * length * element.material.density;
            });
            document.getElementById('totalWeight').textContent = totalWeight.toFixed(1);
        }

        function clearStructure() {
            currentStructure = {
                nodes: [],
                elements: [],
                supports: [],
                loads: [],
                selectedMaterial: materialDatabase[0]
            };
            analysisResults = null;
            
            drawTrussGrid(document.getElementById('trussCanvas'));
            
            // ÁµêÊûú„Çí„É™„Çª„ÉÉ„Éà
            document.getElementById('maxStress').textContent = '0';
            document.getElementById('maxDisp').textContent = '0';
            document.getElementById('safetyFactor').textContent = '‚àû';
            document.getElementById('totalWeight').textContent = '0';
        }

        // Ê¢ÅËß£ÊûêÈñ¢Êï∞
        function drawBeamStructure() {
            const canvas = document.getElementById('beamCanvas');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            const beamLength = currentBeam.length;
            const scale = 600 / beamLength; // „Éî„ÇØ„Çª„É´/m
            const beamY = 200;
            const beamStartX = 100;
            const beamEndX = beamStartX + beamLength * scale;
            
            // Ê¢Å„ÅÆÊèèÁîª
            ctx.strokeStyle = '#495057';
            ctx.lineWidth = 8;
            ctx.beginPath();
            ctx.moveTo(beamStartX, beamY);
            ctx.lineTo(beamEndX, beamY);
            ctx.stroke();
            
            // ÊîØÊåÅÊù°‰ª∂„ÅÆÊèèÁîª
            drawSupports(ctx, beamStartX, beamEndX, beamY);
            
            // Ëç∑Èáç„ÅÆÊèèÁîª
            currentBeam.loads.forEach(load => {
                const x = beamStartX + load.position * scale;
                drawBeamLoad(ctx, x, beamY, load);
            });
            
            // „Çπ„Ç±„Éº„É´Ë°®Á§∫
            ctx.fillStyle = '#495057';
            ctx.font = '12px Arial';
            ctx.fillText(`Ê¢ÅÈï∑: ${beamLength}m`, beamStartX, beamY + 50);
        }

        function drawSupports(ctx, startX, endX, y) {
            const supportType = currentBeam.support;
            
            if (supportType === 'simple') {
                // ÂçòÁ¥îÊ¢ÅÔºà„Éî„É≥ + „É≠„Éº„É©„ÉºÔºâ
                drawPinSupport(ctx, startX, y);
                drawRollerSupport(ctx, endX, y);
            } else if (supportType === 'cantilever') {
                // ÁâáÊåÅ„Å°Ê¢ÅÔºàÂõ∫ÂÆöÊîØÊåÅÔºâ
                drawFixedSupport(ctx, startX, y);
            } else if (supportType === 'fixed') {
                // ‰∏°Á´ØÂõ∫ÂÆöÊ¢Å
                drawFixedSupport(ctx, startX, y);
                drawFixedSupport(ctx, endX, y);
            }
        }

        function drawPinSupport(ctx, x, y) {
            ctx.beginPath();
            ctx.moveTo(x - 15, y + 10);
            ctx.lineTo(x, y);
            ctx.lineTo(x + 15, y + 10);
            ctx.closePath();
            ctx.fillStyle = '#ffc107';
            ctx.fill();
            ctx.strokeStyle = '#343a40';
            ctx.lineWidth = 2;
            ctx.stroke();
        }

        function drawRollerSupport(ctx, x, y) {
            ctx.beginPath();
            ctx.arc(x, y + 15, 8, 0, 2 * Math.PI);
            ctx.fillStyle = '#ffc107';
            ctx.fill();
            ctx.strokeStyle = '#343a40';
            ctx.lineWidth = 2;
            ctx.stroke();
            
            // ‰∏âËßíÂΩ¢
            ctx.beginPath();
            ctx.moveTo(x - 12, y + 7);
            ctx.lineTo(x, y);
            ctx.lineTo(x + 12, y + 7);
            ctx.closePath();
            ctx.fill();
            ctx.stroke();
        }

        function drawFixedSupport(ctx, x, y) {
            ctx.fillStyle = '#6c757d';
            ctx.fillRect(x - 3, y - 20, 6, 40);
            
            // „Éè„ÉÉ„ÉÅ„É≥„Ç∞
            ctx.strokeStyle = '#343a40';
            ctx.lineWidth = 1;
            for (let i = -15; i <= 15; i += 5) {
                ctx.beginPath();
                ctx.moveTo(x - 3, y + i);
                ctx.lineTo(x - 10, y + i - 7);
                ctx.stroke();
            }
        }

        function drawBeamLoad(ctx, x, y, load) {
            if (load.type === 'point') {
                // ÈõÜ‰∏≠Ëç∑Èáç
                drawLoadArrow(ctx, x, y - 50, 0, load.value * 5);
                ctx.fillStyle = '#e74c3c';
                ctx.font = '12px Arial';
                ctx.fillText(`${load.value}kN`, x + 5, y - 60);
            } else if (load.type === 'distributed') {
                // ÂàÜÂ∏ÉËç∑Èáç
                const scale = 600 / currentBeam.length;
                const startX = x;
                const endX = x + (load.endPosition - load.position) * scale;
                
                for (let i = startX; i <= endX; i += 20) {
                    drawLoadArrow(ctx, i, y - 30, 0, load.value * 2);
                }
                
                ctx.fillStyle = '#e74c3c';
                ctx.font = '12px Arial';
                ctx.fillText(`${load.value}kN/m`, startX, y - 40);
            }
        }

        function addBeamLoad() {
            const loadType = document.getElementById('loadType').value;
            const loadValue = parseFloat(document.getElementById('loadValue').value);
            const loadPosition = parseFloat(document.getElementById('loadPosition').value);
            
            if (loadPosition > currentBeam.length) {
                showMessage('Ëç∑Èáç‰ΩçÁΩÆ„ÅåÊ¢ÅÈï∑„ÇíË∂Ö„Åà„Å¶„ÅÑ„Åæ„Åô„ÄÇ', 'error');
                return;
            }
            
            const load = {
                type: loadType,
                value: loadValue,
                position: loadPosition
            };
            
            if (loadType === 'distributed') {
                load.endPosition = Math.min(loadPosition + 2, currentBeam.length);
            }
            
            currentBeam.loads.push(load);
            drawBeamStructure();
        }

        function analyzeBeam() {
            if (currentBeam.loads.length === 0) {
                showMessage('Ëç∑Èáç„ÇíË®≠ÂÆö„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ', 'error');
                return;
            }
            
            showAnalysisProgress();
            
            setTimeout(() => {
                try {
                    const results = performBeamAnalysis();
                    drawBeamDiagrams(results);
                    showMessage('Ê¢ÅËß£Êûê„ÅåÂÆå‰∫Ü„Åó„Åæ„Åó„Åü„ÄÇ', 'success');
                } catch (error) {
                    showMessage('Ëß£Êûê„Ç®„É©„Éº: ' + error.message, 'error');
                }
                hideAnalysisProgress();
            }, 1000);
        }

        function performBeamAnalysis() {
            const length = currentBeam.length;
            const numPoints = 101; // Ëß£ÊûêÁÇπÊï∞
            const dx = length / (numPoints - 1);
            
            const x = [];
            const M = []; // Êõ≤„Åí„É¢„Éº„É°„É≥„Éà
            const Q = []; // „Åõ„ÇìÊñ≠Âäõ
            const delta = []; // „Åü„Çè„Åø
            
            for (let i = 0; i < numPoints; i++) {
                x.push(i * dx);
                M.push(0);
                Q.push(0);
                delta.push(0);
            }
            
            // Ëç∑Èáç„Å´„Çà„ÇãÂΩ±Èüø„ÇíË®àÁÆó
            currentBeam.loads.forEach(load => {
                if (load.type === 'point') {
                    // ÈõÜ‰∏≠Ëç∑Èáç
                    calculatePointLoadEffects(x, M, Q, delta, load, length);
                } else if (load.type === 'distributed') {
                    // ÂàÜÂ∏ÉËç∑Èáç
                    calculateDistributedLoadEffects(x, M, Q, delta, load, length);
                }
            });
            
            return { x, M, Q, delta };
        }

        function calculatePointLoadEffects(x, M, Q, delta, load, L) {
            const P = load.value * 1000; // kN to N
            const a = load.position;
            const b = L - a;
            
            // ÊîØÊåÅÊù°‰ª∂„Å´Âøú„Åò„ÅüË®àÁÆó
            if (currentBeam.support === 'simple') {
                // ÂçòÁ¥îÊ¢Å
                const R1 = P * b / L;
                const R2 = P * a / L;
                
                for (let i = 0; i < x.length; i++) {
                    if (x[i] <= a) {
                        Q[i] += R1;
                        M[i] += R1 * x[i];
                    } else {
                        Q[i] += R1 - P;
                        M[i] += R1 * x[i] - P * (x[i] - a);
                    }
                }
            } else if (currentBeam.support === 'cantilever') {
                // ÁâáÊåÅ„Å°Ê¢Å
                for (let i = 0; i < x.length; i++) {
                    if (x[i] >= a) {
                        Q[i] -= P;
                        M[i] -= P * (x[i] - a);
                    }
                }
            }
        }

        function calculateDistributedLoadEffects(x, M, Q, delta, load, L) {
            const w = load.value * 1000; // kN/m to N/m
            const start = load.position;
            const end = load.endPosition || start + 1;
            
            if (currentBeam.support === 'simple') {
                // ÂçòÁ¥îÊ¢Å„ÅÆÂàÜÂ∏ÉËç∑Èáç
                const a = start;
                const c = end - start;
                const W = w * c; // Á∑èËç∑Èáç
                const R1 = W * (L - a - c/2) / L;
                const R2 = W * (a + c/2) / L;
                
                for (let i = 0; i < x.length; i++) {
                    if (x[i] <= a) {
                        Q[i] += R1;
                        M[i] += R1 * x[i];
                    } else if (x[i] <= end) {
                        const loadLength = x[i] - a;
                        Q[i] += R1 - w * loadLength;
                        M[i] += R1 * x[i] - w * loadLength * loadLength / 2;
                    } else {
                        Q[i] += R1 - W;
                        M[i] += R1 * x[i] - W * (x[i] - a - c/2);
                    }
                }
            }
        }

        function drawBeamDiagrams(results) {
            drawDiagram('sfdCanvas', results.x, results.Q, '„Åõ„ÇìÊñ≠Âäõ (kN)', '#28a745');
            drawDiagram('bmdCanvas', results.x, results.M, 'Êõ≤„Åí„É¢„Éº„É°„É≥„Éà (kN¬∑m)', '#dc3545');
            drawDiagram('deflectionCanvas', results.x, results.delta, '„Åü„Çè„Åø (mm)', '#007bff');
        }

        function drawDiagram(canvasId, x, y, label, color) {
            const canvas = document.getElementById(canvasId);
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Ëª∏„Å®„Ç∞„É™„ÉÉ„Éâ
            ctx.strokeStyle = '#e9ecef';
            ctx.lineWidth = 1;
            
            // Âü∫Ê∫ñÁ∑ö
            const zeroY = canvas.height / 2;
            ctx.beginPath();
            ctx.moveTo(50, zeroY);
            ctx.lineTo(canvas.width - 50, zeroY);
            ctx.stroke();
            
            // „Éá„Éº„Çø„ÅÆÊèèÁîª
            if (y.length === 0) return;
            
            const maxX = Math.max(...x);
            const maxY = Math.max(...y.map(Math.abs));
            const scaleX = (canvas.width - 100) / maxX;
            const scaleY = maxY > 0 ? (canvas.height - 40) / 2 / maxY : 1;
            
            ctx.strokeStyle = color;
            ctx.lineWidth = 2;
            ctx.beginPath();
            
            for (let i = 0; i < x.length; i++) {
                const px = 50 + x[i] * scaleX;
                const py = zeroY - y[i] * scaleY;
                
                if (i === 0) {
                    ctx.moveTo(px, py);
                } else {
                    ctx.lineTo(px, py);
                }
            }
            
            ctx.stroke();
            
            // „É©„Éô„É´
            ctx.fillStyle = '#495057';
            ctx.font = '12px Arial';
            ctx.fillText(label, 10, 20);
            
            // ÊúÄÂ§ßÂÄ§„ÉªÊúÄÂ∞èÂÄ§„ÅÆË°®Á§∫
            const maxVal = Math.max(...y);
            const minVal = Math.min(...y);
            ctx.fillText(`Max: ${(maxVal/1000).toFixed(2)}`, canvas.width - 100, 20);
            ctx.fillText(`Min: ${(minVal/1000).toFixed(2)}`, canvas.width - 100, 35);
        }

        function clearBeam() {
            currentBeam.loads = [];
            drawBeamStructure();
            
            // Âõ≥Ë°®„Çí„ÇØ„É™„Ç¢
            ['sfdCanvas', 'bmdCanvas', 'deflectionCanvas'].forEach(canvasId => {
                const canvas = document.getElementById(canvasId);
                if (canvas) {
                    const ctx = canvas.getContext('2d');
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                }
            });
        }

        // ÊùêÊñô„Éá„Éº„Çø„Éô„Éº„ÇπÈñ¢Êï∞
        function loadMaterials() {
            const container = document.getElementById('materialDatabase');
            if (!container) return;
            
            container.innerHTML = '';
            
            materialDatabase.forEach(material => {
                const card = document.createElement('div');
                card.className = 'material-card';
                if (currentStructure.selectedMaterial && currentStructure.selectedMaterial.id === material.id) {
                    card.classList.add('selected');
                }
                
                card.innerHTML = `
                    <h4>${material.name}</h4>
                    <p><strong>„Ç´„ÉÜ„Ç¥„É™:</strong> ${getCategoryName(material.category)}</p>
                    <p><strong>ÂºæÊÄß‰øÇÊï∞:</strong> ${material.E.toLocaleString()} MPa</p>
                    <p><strong>ÂØÜÂ∫¶:</strong> ${material.density} kg/m¬≥</p>
                `;
                
                card.addEventListener('click', () => selectMaterial(material));
                container.appendChild(card);
            });
        }

        function getCategoryName(category) {
            const names = {
                steel: 'ÈãºÊùê',
                concrete: '„Ç≥„É≥„ÇØ„É™„Éº„Éà',
                wood: 'Êú®Êùê',
                aluminum: '„Ç¢„É´„Éü„Éã„Ç¶„É†'
            };
            return names[category] || category;
        }

        function selectMaterial(material) {
            currentStructure.selectedMaterial = material;
            loadMaterials(); // ÂÜçÊèèÁîª
            
            // Ë©≥Á¥∞Ë°®Á§∫
            const details = document.getElementById('materialDetails');
            details.innerHTML = `
                <h4>${material.name}</h4>
                <div class="results-grid">
                    <div class="result-card">
                        <h4>ÂºæÊÄß‰øÇÊï∞ (E)</h4>
                        <div class="result-value">${material.E.toLocaleString()}<span class="result-unit">MPa</span></div>
                    </div>
                    <div class="result-card">
                        <h4>Èôç‰ºèÂº∑Â∫¶</h4>
                        <div class="result-value">${material.fy || material.fc || material.fb || '-'}<span class="result-unit">MPa</span></div>
                    </div>
                    <div class="result-card">
                        <h4>ÂØÜÂ∫¶</h4>
                        <div class="result-value">${material.density}<span class="result-unit">kg/m¬≥</span></div>
                    </div>
                    <div class="result-card">
                        <h4>„Éù„Ç¢„ÇΩ„É≥ÊØî</h4>
                        <div class="result-value">${material.poisson}<span class="result-unit">-</span></div>
                    </div>
                </div>
            `;
        }

        function filterMaterials() {
            const category = document.getElementById('materialCategory').value;
            const search = document.getElementById('materialSearch').value.toLowerCase();
            
            const filtered = materialDatabase.filter(material => {
                const categoryMatch = category === 'all' || material.category === category;
                const searchMatch = material.name.toLowerCase().includes(search);
                return categoryMatch && searchMatch;
            });
            
            const container = document.getElementById('materialDatabase');
            container.innerHTML = '';
            
            filtered.forEach(material => {
                const card = document.createElement('div');
                card.className = 'material-card';
                if (currentStructure.selectedMaterial && currentStructure.selectedMaterial.id === material.id) {
                    card.classList.add('selected');
                }
                
                card.innerHTML = `
                    <h4>${material.name}</h4>
                    <p><strong>„Ç´„ÉÜ„Ç¥„É™:</strong> ${getCategoryName(material.category)}</p>
                    <p><strong>ÂºæÊÄß‰øÇÊï∞:</strong> ${material.E.toLocaleString()} MPa</p>
                    <p><strong>ÂØÜÂ∫¶:</strong> ${material.density} kg/m¬≥</p>
                `;
                
                card.addEventListener('click', () => selectMaterial(material));
                container.appendChild(card);
            });
        }

        // Â≠¶Áøí„É¢„Éº„ÉâÈñ¢Êï∞
        function loadLearningContent() {
            const topic = document.getElementById('learningTopic')?.value || 'basics';
            const container = document.getElementById('learningContent');
            
            if (container && learningContent[topic]) {
                container.innerHTML = `
                    <div class="chart-container">
                        <h3>${learningContent[topic].title}</h3>
                        ${learningContent[topic].content}
                    </div>
                `;
            }
        }

        // ‰æãÈ°åÈõÜÈñ¢Êï∞
        function loadExamples() {
            const category = document.getElementById('exampleCategory')?.value || 'truss';
            const container = document.getElementById('examplesList');
            
            if (container && exampleProblems[category]) {
                container.innerHTML = '';
                
                exampleProblems[category].forEach(problem => {
                    const card = document.createElement('div');
                    card.className = 'chart-container';
                    card.innerHTML = `
                        <h4>${problem.title}</h4>
                        <p><strong>Èõ£ÊòìÂ∫¶:</strong> ${problem.difficulty}</p>
                        <p><strong>ÂïèÈ°å:</strong> ${problem.description}</p>
                        <details>
                            <summary>Ëß£Á≠î„ÇíË°®Á§∫</summary>
                            <div class="calculation-steps">
                                ${problem.solution}
                            </div>
                        </details>
                        <button class="btn" onclick="loadExampleProblem('${problem.id}')">„Åì„ÅÆÂïèÈ°å„ÇíË™≠„ÅøËæº„Åø</button>
                    `;
                    container.appendChild(card);
                });
            }
        }

        function loadExampleProblem(problemId) {
            // ‰æãÈ°å„ÇíÁèæÂú®„ÅÆËß£Êûê„É¢„Éá„É´„Å´Ë™≠„ÅøËæº„Åø
            if (problemId === 'truss_01') {
                // Âü∫Êú¨„Éà„É©„ÇπÂïèÈ°å„ÇíË™≠„ÅøËæº„Åø
                clearStructure();
                currentStructure.nodes = [
                    {x: 100, y: 300},
                    {x: 300, y: 300},
                    {x: 200, y: 200}
                ];
                currentStructure.elements = [
                    {node1: 0, node2: 2, area: 0.01, material: materialDatabase[0]},
                    {node1: 1, node2: 2, area: 0.01, material: materialDatabase[0]}
                ];
                currentStructure.supports = [
                    {node: 0, type: 'pin', ux: true, uy: true},
                    {node: 1, type: 'roller', ux: false, uy: true}
                ];
                currentStructure.loads = [
                    {node: 2, fx: 0, fy: -10000}
                ];
                
                drawTrussGrid(document.getElementById('trussCanvas'));
                
                // „Éà„É©„ÇπËß£Êûê„Çø„Éñ„Å´Âàá„ÇäÊõø„Åà
                document.querySelector('[data-tab="truss"]').click();
            }
        }

        // „É¶„Éº„ÉÜ„Ç£„É™„ÉÜ„Ç£Èñ¢Êï∞
        function showAnalysisProgress() {
            isAnalyzing = true;
            const progressBar = document.getElementById('progressBar');
            let progress = 0;
            
            const interval = setInterval(() => {
                progress += 10;
                if (progressBar) {
                    progressBar.style.width = progress + '%';
                }
                
                if (progress >= 100 || !isAnalyzing) {
                    clearInterval(interval);
                }
            }, 100);
        }

        function hideAnalysisProgress() {
            isAnalyzing = false;
            const progressBar = document.getElementById('progressBar');
            if (progressBar) {
                progressBar.style.width = '0%';
            }
        }

        function showMessage(message, type) {
            const messageDiv = document.createElement('div');
            messageDiv.className = type === 'error' ? 'error-message' : 'success-message';
            messageDiv.textContent = message;
            
            const container = document.querySelector('.main-content');
            container.insertBefore(messageDiv, container.firstChild);
            
            setTimeout(() => {
                messageDiv.remove();
            }, 5000);
        }

        function generateReport() {
            // „É¨„Éù„Éº„ÉàÁîüÊàêÊ©üËÉΩÔºàÁ∞°ÊòìÁâàÔºâ
            const reportWindow = window.open('', '_blank');
            reportWindow.document.write(`
                <html>
                <head>
                    <title>ÊßãÈÄ†Ëß£Êûê„É¨„Éù„Éº„Éà</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 40px; }
                        h1, h2 { color: #333; }
                        table { border-collapse: collapse; width: 100%; margin: 20px 0; }
                        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
                        th { background-color: #f2f2f2; }
                    </style>
                </head>
                <body>
                    <h1>ÊßãÈÄ†Ëß£Êûê„É¨„Éù„Éº„Éà</h1>
                    <h2>Ëß£ÊûêÊù°‰ª∂</h2>
                    <p>Ê¢ÅÈï∑: ${currentBeam.length}m</p>
                    <p>ÊîØÊåÅÊù°‰ª∂: ${currentBeam.support}</p>
                    <p>Ëç∑ÈáçÊï∞: ${currentBeam.loads.length}</p>
                    
                    <h2>Ëß£ÊûêÁµêÊûú</h2>
                    <p>„Åì„ÅÆ„É¨„Éù„Éº„Éà„ÅØÊßãÈÄ†ÂäõÂ≠¶„Ç∑„Éü„É•„É¨„Éº„Çø„Éº„ÅßÁîüÊàê„Åï„Çå„Åæ„Åó„Åü„ÄÇ</p>
                    
                    <h2>ÁµêË´ñ</h2>
                    <p>Ë®≠Ë®àÊù°‰ª∂„ÇíÊ∫ÄË∂≥„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ</p>
                </body>
                </html>
            `);
        }

        // „Ç≠„É£„É≥„Éê„Çπ„Ç§„Éô„É≥„Éà„Éè„É≥„Éâ„É©
        function handleTrussCanvasClick(event) {
            const canvas = event.target;
            const rect = canvas.getBoundingClientRect();
            const x = event.clientX - rect.left;
            const y = event.clientY - rect.top;
            
            // „Ç∞„É™„ÉÉ„Éâ„Çπ„Éä„ÉÉ„Éó
            const snapX = Math.round(x / 40) * 40;
            const snapY = Math.round(y / 40) * 40;
            
            // Êó¢Â≠ò„ÅÆÁØÄÁÇπ„Å®ÈáçË§á„ÉÅ„Çß„ÉÉ„ÇØ
            const existingNode = currentStructure.nodes.find(node => 
                Math.abs(node.x - snapX) < 20 && Math.abs(node.y - snapY) < 20
            );
            
            if (!existingNode) {
                currentStructure.nodes.push({x: snapX, y: snapY});
                drawTrussGrid(canvas);
            }
        }

        function handleTrussCanvasHover(event) {
            const canvas = event.target;
            const rect = canvas.getBoundingClientRect();
            const x = event.clientX - rect.left;
            const y = event.clientY - rect.top;
            
            // ÁØÄÁÇπ„ÇÑ„Ç®„É¨„É°„É≥„Éà„ÅÆÊÉÖÂ†±Ë°®Á§∫
            const nodeInfo = document.getElementById('nodeInfo');
            const elementInfo = document.getElementById('elementInfo');
            
            // Ëøë„Åè„ÅÆÁØÄÁÇπ„ÇíÊ§úÁ¥¢
            const nearbyNode = currentStructure.nodes.findIndex(node => 
                Math.sqrt((node.x - x) ** 2 + (node.y - y) ** 2) < 15
            );
            
            if (nearbyNode !== -1) {
                nodeInfo.style.display = 'block';
                nodeInfo.style.left = (rect.left + x + 10) + 'px';
                nodeInfo.style.top = (rect.top + y - 30) + 'px';
                
                let info = `ÁØÄÁÇπ ${nearbyNode}`;
                if (analysisResults && analysisResults.nodeDisplacements[nearbyNode]) {
                    const disp = analysisResults.nodeDisplacements[nearbyNode];
                    info += `<br>Â§â‰Ωç: (${disp.x.toFixed(2)}, ${disp.y.toFixed(2)})mm`;
                }
                nodeInfo.innerHTML = info;
            } else {
                nodeInfo.style.display = 'none';
            }
        }

        // „Éë„Éï„Ç©„Éº„Éû„É≥„ÇπÊúÄÈÅ©Âåñ
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // „É¨„Çπ„Éù„É≥„Ç∑„ÉñÂØæÂøú
        window.addEventListener('resize', debounce(() => {
            const canvases = document.querySelectorAll('canvas');
            canvases.forEach(canvas => {
                if (canvas.id === 'trussCanvas') {
                    drawTrussGrid(canvas);
                } else if (canvas.id === 'beamCanvas') {
                    drawBeamStructure();
                }
            });
        }, 250));

        // „Éá„É¢Ê©üËÉΩ
        function demoBasics() {
            const canvas = document.getElementById('basicsDemo');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Âäõ„ÅÆÈá£„ÇäÂêà„ÅÑ„Éá„É¢
            ctx.strokeStyle = '#007bff';
            ctx.lineWidth = 3;
            
            // Ê∞¥Âπ≥Âäõ
            ctx.beginPath();
            ctx.moveTo(200, 100);
            ctx.lineTo(150, 100);
            ctx.stroke();
            drawArrowHead(ctx, 150, 100, Math.PI, '#007bff');
            
            ctx.beginPath();
            ctx.moveTo(200, 100);
            ctx.lineTo(250, 100);
            ctx.stroke();
            drawArrowHead(ctx, 250, 100, 0, '#007bff');
            
            // ‰∏≠ÂøÉÁÇπ
            ctx.beginPath();
            ctx.arc(200, 100, 5, 0, 2 * Math.PI);
            ctx.fillStyle = '#dc3545';
            ctx.fill();
            
            // „É©„Éô„É´
            ctx.fillStyle = '#495057';
            ctx.font = '12px Arial';
            ctx.fillText('F1', 130, 95);
            ctx.fillText('F2', 255, 95);
            ctx.fillText('Œ£F = 0', 180, 130);
        }

        function drawArrowHead(ctx, x, y, angle, color) {
            const headlen = 8;
            ctx.fillStyle = color;
            ctx.beginPath();
            ctx.moveTo(x, y);
            ctx.lineTo(x - headlen * Math.cos(angle - Math.PI/6), y - headlen * Math.sin(angle - Math.PI/6));
            ctx.lineTo(x - headlen * Math.cos(angle + Math.PI/6), y - headlen * Math.sin(angle + Math.PI/6));
            ctx.closePath();
            ctx.fill();
        }

        // ÂìÅË≥™‰øùË®º„Å®„Ç®„É©„Éº„Éè„É≥„Éâ„É™„É≥„Ç∞
        window.addEventListener('error', function(event) {
            console.error('„Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥„Ç®„É©„Éº:', event.error);
            showMessage('‰∫àÊúü„Åó„Å™„ÅÑ„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü„ÄÇ„Éö„Éº„Ç∏„ÇíÂÜçË™≠„ÅøËæº„Åø„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ', 'error');
        });

        // „Éë„Éï„Ç©„Éº„Éû„É≥„ÇπÁõ£Ë¶ñ
        let performanceMetrics = {
            analysisTime: 0,
            renderTime: 0,
            lastAnalysis: null
        };

        function measurePerformance(operation, func) {
            const start = performance.now();
            const result = func();
            const end = performance.now();
            
            performanceMetrics[operation + 'Time'] = end - start;
            performanceMetrics.lastAnalysis = new Date();
            
            return result;
        }

        // Ëá™Âãï‰øùÂ≠òÊ©üËÉΩÔºà„Ç™„Éó„Ç∑„Éß„É≥Ôºâ
        function autoSave() {
            const data = {
                structure: currentStructure,
                beam: currentBeam,
                timestamp: new Date().toISOString()
            };
            
            try {
                localStorage.setItem('structuralAnalysisAutoSave', JSON.stringify(data));
            } catch (e) {
                console.warn('Ëá™Âãï‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü:', e);
            }
        }

        function autoLoad() {
            try {
                const saved = localStorage.getItem('structuralAnalysisAutoSave');
                if (saved) {
                    const data = JSON.parse(saved);
                    // ÂøÖË¶Å„Å´Âøú„Åò„Å¶Âæ©ÂÖÉ„É≠„Ç∏„ÉÉ„ÇØ„ÇíÂÆüË£Ö
                }
            } catch (e) {
                console.warn('Ëá™ÂãïË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü:', e);
            }
        }

        // ÂÆöÊúüÁöÑ„Å™Ëá™Âãï‰øùÂ≠ò
        setInterval(autoSave, 30000); // 30Áßí„Åî„Å®
    </script>
</body>
</html>