# 要件・仕様書: Ultra Meteor Storm Generator

## 元要求
[0000012] 超絶格好良い隕石落下アニメーション生成
- 音もそれらしいものが鳴る
- 迫力がある隕石
- とにかく格好良い
- 軽量かつスピード感を損ねない
- 単調にならない
- 色々な隕石を表現できる
- あとは君のセンスだ！！

## 解釈した仕様

### 基本システム仕様
- **アプリタイプ**: リアルタイム隕石落下シミュレーター
- **描画エンジン**: HTML5 Canvas 2D（60FPS目標）
- **物理演算**: カスタム物理エンジン（重力、角度、回転、摩擦）
- **音響システム**: Web Audio API動的生成
- **制御方式**: GUI スライダー + ボタン + キーボードショートカット

### 隕石タイプ仕様（「色々な隕石を表現」の実現）
1. **Standard（標準）🔥**
   - 色: #ff4500 → #ffa500 グラデーション
   - サイズ: 5-25px、速度: 2-8、ダメージ: 10
   - 音響: 200Hz sawtooth波、パーティクル: 15個

2. **Ice（氷）❄️**
   - 色: #87ceeb → #00ffff グラデーション
   - サイズ: 8-30px、速度: 1.5-6、ダメージ: 8
   - 音響: 400Hz sine波、パーティクル: 20個

3. **Plasma（プラズマ）⚡**
   - 色: #8a2be2 → #ff1493 グラデーション
   - サイズ: 4-20px、速度: 4-12、ダメージ: 15
   - 音響: 800Hz square波、パーティクル: 25個

4. **Toxic（毒性）☢️**
   - 色: #32cd32 → #00ff00 グラデーション
   - サイズ: 6-28px、速度: 2-7、ダメージ: 12
   - 音響: 150Hz triangle波、パーティクル: 18個

5. **Crystal（水晶）💎**
   - 色: #b9f2ff → #dda0dd グラデーション
   - サイズ: 10-35px、速度: 1-5、ダメージ: 20
   - 音響: 600Hz sine波、パーティクル: 30個

6. **Dark（暗黒）🌑**
   - 色: #2f2f2f → #000000 グラデーション
   - サイズ: 15-40px、速度: 3-9、ダメージ: 25
   - 音響: 100Hz sawtooth波、パーティクル: 12個

### 音響仕様（「音もそれらしい」の実現）
- **音響生成**: Web Audio API + Oscillator
- **波形種類**: 4種類（sine, square, triangle, sawtooth）
- **周波数範囲**: 100Hz-800Hz（隕石タイプ別差別化）
- **音響特性**: 
  - 周波数：隕石タイプ別固有設定
  - 減衰：指数的フェードアウト
  - フィルター：ローパスフィルター適用
  - 音量：隕石サイズ比例調整

### 視覚効果仕様（「とにかく格好良い」の実現）
1. **宇宙背景システム**
   - 動的ネビュラアニメーション（20秒周期）
   - 星座パターン生成（5レイヤー重複）
   - 大気層表現（上部20%にグラデーション）

2. **隕石描画システム**
   - ラジアルグラデーション（中心白→外縁色）
   - 回転アニメーション（個体別速度）
   - グロー効果（サイズ×2範囲）
   - 表面クレーター表現（3箇所ランダム配置）

3. **軌跡システム**
   - 15ポイント軌跡記録
   - 時間経過フェードアウト
   - 隕石タイプ別色彩
   - 幅可変（速度・サイズ比例）

4. **パーティクルシステム**
   - 衝突時放射状散乱
   - 物理的重力効果
   - タイプ別パーティクル数
   - ライフサイクル管理（自動削除）

### 迫力表現仕様（「迫力がある隕石」の実現）
1. **サイズ・スケール**
   - 最大40px（Darkタイプ）
   - サイズ可変倍率：1x-10x
   - 画面比例スケーリング

2. **インパクト演出**
   - スクリーンシェイク（大型隕石のみ）
   - インパクトフラッシュ（拡散アニメーション）
   - 破片飛散エフェクト（8方向散乱）
   - ダメージ蓄積表示

3. **メガストーム機能**
   - 10隕石同時発射
   - 全タイプランダム選択
   - 特殊音響効果（1秒持続）
   - 100ms間隔連続生成

### パフォーマンス仕様（「軽量かつスピード感」の実現）
1. **軽量化対策**
   - 総ファイルサイズ: 50KB以下
   - 外部依存ライブラリ: 0個
   - 画像ファイル: 0個（全CSS/Canvas描画）
   - 初期化時間: 1秒以下

2. **スピード最適化**
   - 60FPS安定動作
   - requestAnimationFrame活用
   - パーティクル数制限（メモリ管理）
   - 効率的衝突判定

3. **リソース管理**
   - オブジェクトプーリング概念適用
   - 不要オブジェクト自動削除
   - メモリ使用量40MB以下維持

### バリエーション仕様（「単調にならない」の実現）
1. **隕石生成ランダム性**
   - サイズ：範囲内ランダム
   - 速度：範囲内ランダム + 倍率調整
   - 角度：-30°〜+30°ランダム
   - 回転速度：-5〜+5ランダム
   - 出現位置：画面幅全域ランダム

2. **制御パラメータ**
   - 生成間隔：50ms-500ms可変
   - サイズ倍率：1x-10x可変
   - 速度倍率：0.5x-3x可変
   - エフェクト個別ON/OFF

3. **インタラクション要素**
   - 6隕石タイプ瞬時切替
   - メガストーム発動
   - リアルタイム統計表示
   - キーボードショートカット（1-6キー）

## 技術的制約・判断

### Canvas 2D選択理由
- **制約**: WebGL学習コスト vs 開発時間
- **判断**: Canvas 2D + 最適化で十分な視覚品質達成可能
- **理由**: ブラウザ互換性重視、軽量性確保

### 物理演算実装方針
- **制約**: 既存物理ライブラリ使用禁止（軽量化要件）  
- **判断**: カスタム物理エンジン実装
- **理由**: 必要最小限機能で軽量化、学習効果最大化

### 音響システム設計
- **制約**: Web Audio API のブラウザ対応差
- **対策**: try-catch安全実装、段階的機能提供
- **判断**: 動的生成優先、プリセット音源は非採用

### レスポンシブ対応方針
- **制約**: Canvas解像度 vs パフォーマンス
- **判断**: 固定解像度 + CSS スケーリング
- **理由**: 描画負荷一定化、全デバイス対応

### メモリ管理戦略
- **制約**: 長時間動作でのメモリリーク防止
- **対策**: オブジェクトライフサイクル管理、配列自動削除
- **判断**: GC頻度最小化、パフォーマンス優先

## 変更履歴
- 2025-07-26: 初回作成（v0.8ワークフロー使用）
- 6隕石タイプ体系の確立
- Web Audio API動的音響システム構築
- Canvas 2D高速描画エンジン実装
- パーティクルシステム最適化
- レスポンシブ対応完了