<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>体重データ機械学習分析システム</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container { 
            max-width: 1200px; 
            margin: 0 auto; 
            background: white; 
            border-radius: 15px; 
            box-shadow: 0 20px 40px rgba(0,0,0,0.1); 
            overflow: hidden;
        }
        .header { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            color: white; 
            padding: 30px; 
            text-align: center; 
        }
        .header h1 { 
            font-size: 2.5em; 
            margin-bottom: 10px; 
            font-weight: 300; 
        }
        .header p { 
            font-size: 1.1em; 
            opacity: 0.9; 
        }
        .content { 
            padding: 30px; 
        }
        .section { 
            margin: 30px 0; 
            padding: 25px; 
            border: 2px solid #eee; 
            border-radius: 10px; 
            transition: all 0.3s ease;
        }
        .section:hover { 
            border-color: #667eea; 
            box-shadow: 0 5px 15px rgba(102,126,234,0.1); 
        }
        .section h2 { 
            color: #333; 
            margin-bottom: 20px; 
            padding-bottom: 10px; 
            border-bottom: 2px solid #eee; 
        }
        .btn { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            color: white; 
            border: none; 
            padding: 12px 30px; 
            border-radius: 25px; 
            cursor: pointer; 
            font-size: 1em; 
            margin: 5px; 
            transition: all 0.3s ease;
        }
        .btn:hover { 
            transform: translateY(-2px); 
            box-shadow: 0 5px 15px rgba(102,126,234,0.3); 
        }
        .btn:disabled { 
            opacity: 0.6; 
            cursor: not-allowed; 
            transform: none; 
        }
        .status { 
            padding: 15px; 
            border-radius: 8px; 
            margin: 15px 0; 
            font-weight: bold; 
        }
        .success { 
            background: #d4edda; 
            color: #155724; 
            border: 1px solid #c3e6cb; 
        }
        .error { 
            background: #f8d7da; 
            color: #721c24; 
            border: 1px solid #f5c6cb; 
        }
        .info { 
            background: #d1ecf1; 
            color: #0c5460; 
            border: 1px solid #bee5eb; 
        }
        .analysis-results { 
            background: #f8f9fa; 
            padding: 20px; 
            border-radius: 8px; 
            margin: 20px 0; 
        }
        .stat-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); 
            gap: 20px; 
            margin: 20px 0; 
        }
        .stat-card { 
            background: white; 
            padding: 20px; 
            border-radius: 8px; 
            box-shadow: 0 2px 8px rgba(0,0,0,0.1); 
            text-align: center; 
        }
        .stat-value { 
            font-size: 2em; 
            font-weight: bold; 
            color: #667eea; 
        }
        .stat-label { 
            color: #666; 
            margin-top: 5px; 
        }
        .insights { 
            background: #fff3cd; 
            border: 1px solid #ffeaa7; 
            padding: 20px; 
            border-radius: 8px; 
            margin: 20px 0; 
        }
        .insights h3 { 
            color: #856404; 
            margin-bottom: 15px; 
        }
        .insights ul { 
            list-style: none; 
        }
        .insights li { 
            margin: 10px 0; 
            padding: 10px; 
            background: white; 
            border-radius: 5px; 
            border-left: 4px solid #ffc107; 
        }
        .chart-container { 
            margin: 20px 0; 
            text-align: center; 
        }
        #dataTable { 
            width: 100%; 
            border-collapse: collapse; 
            margin: 20px 0; 
        }
        #dataTable th, #dataTable td { 
            border: 1px solid #ddd; 
            padding: 12px; 
            text-align: left; 
        }
        #dataTable th { 
            background: #f8f9fa; 
            font-weight: bold; 
        }
        #dataTable tr:nth-child(even) { 
            background: #f9f9f9; 
        }
        .loading { 
            text-align: center; 
            padding: 20px; 
        }
        .loading:after { 
            content: " "; 
            display: inline-block; 
            width: 20px; 
            height: 20px; 
            border: 3px solid #f3f3f3; 
            border-top: 3px solid #667eea; 
            border-radius: 50%; 
            animation: spin 1s linear infinite; 
        }
        @keyframes spin { 
            0% { transform: rotate(0deg); } 
            100% { transform: rotate(360deg); } 
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🤖 体重データ機械学習分析システム</h1>
            <p>Firebase連携 × AI分析で生活改善提案を生成</p>
        </div>
        
        <div class="content">
            <!-- 認証セクション -->
            <div class="section">
                <h2>🔐 Firebase認証</h2>
                <div id="authStatus" class="status info">認証が必要です</div>
                <button id="loginBtn" class="btn">Googleでログイン</button>
                <button id="logoutBtn" class="btn" style="display:none;">ログアウト</button>
                <div id="userInfo" style="margin-top: 15px; display: none;">
                    <strong>ログイン中:</strong> <span id="userName"></span>
                </div>
            </div>
            
            <!-- データ取得セクション -->
            <div class="section">
                <h2>📊 データ取得・分析</h2>
                <button id="fetchDataBtn" class="btn" disabled>体重データを取得</button>
                <button id="demoDataBtn" class="btn">デモデータで動作確認</button>
                <button id="analyzeBtn" class="btn" disabled>機械学習分析実行</button>
                <div id="dataStatus" class="status info">認証後にデータ取得が可能になります</div>
                <div id="dataInfo"></div>
            </div>
            
            <!-- 基本統計 -->
            <div class="section" id="statisticsSection" style="display: none;">
                <h2>📈 基本統計</h2>
                <div class="stat-grid" id="statGrid"></div>
            </div>
            
            <!-- グラフ表示 -->
            <div class="section" id="chartsSection" style="display: none;">
                <h2>📊 グラフ表示</h2>
                <div class="chart-container">
                    <canvas id="weightChart" width="400" height="200"></canvas>
                </div>
                <div class="chart-container" style="margin-top: 30px;">
                    <canvas id="weeklyChart" width="400" height="200"></canvas>
                </div>
            </div>
            
            <!-- 機械学習結果 -->
            <div class="section" id="mlSection" style="display: none;">
                <h2>🤖 機械学習分析結果</h2>
                <div id="mlResults"></div>
            </div>
            
            <!-- AI改善提案 -->
            <div class="section" id="insightsSection" style="display: none;">
                <h2>💡 AI改善提案</h2>
                <div class="insights" id="insights"></div>
            </div>
            
            <!-- データテーブル -->
            <div class="section" id="dataSection" style="display: none;">
                <h2>📋 データ詳細</h2>
                <table id="dataTable"></table>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    
    <!-- Chart.js for graphs -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <script>
        // Firebase設定
        const firebaseConfig = {
            apiKey: "AIzaSyA5PXKChizYDCXF_GJ4KL6Ylq9K5hCPXWE",
            authDomain: "shares-b1b97.firebaseapp.com",
            databaseURL: "https://shares-b1b97-default-rtdb.firebaseio.com",
            projectId: "shares-b1b97",
            storageBucket: "shares-b1b97.firebasestorage.app",
            messagingSenderId: "38311063248",
            appId: "1:38311063248:web:0d2d5726d12b305b24b8d5"
        };
        
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const database = firebase.database();
        
        let userData = null;
        let weightData = null;
        
        // DOM要素
        const authStatus = document.getElementById('authStatus');
        const loginBtn = document.getElementById('loginBtn');
        const logoutBtn = document.getElementById('logoutBtn');
        const userInfo = document.getElementById('userInfo');
        const userName = document.getElementById('userName');
        const fetchDataBtn = document.getElementById('fetchDataBtn');
        const demoDataBtn = document.getElementById('demoDataBtn');
        const analyzeBtn = document.getElementById('analyzeBtn');
        const dataStatus = document.getElementById('dataStatus');
        const dataInfo = document.getElementById('dataInfo');
        
        // 認証状態監視
        auth.onAuthStateChanged((user) => {
            if (user) {
                userData = user;
                authStatus.innerHTML = '<span class="success">✅ 認証済み</span>';
                authStatus.className = 'status success';
                loginBtn.style.display = 'none';
                logoutBtn.style.display = 'inline-block';
                userInfo.style.display = 'block';
                userName.textContent = user.displayName || user.email;
                fetchDataBtn.disabled = false;
                dataStatus.innerHTML = '<span class="info">データ取得の準備ができました</span>';
                dataStatus.className = 'status info';
            } else {
                userData = null;
                authStatus.innerHTML = '<span class="info">認証が必要です</span>';
                authStatus.className = 'status info';
                loginBtn.style.display = 'inline-block';
                logoutBtn.style.display = 'none';
                userInfo.style.display = 'none';
                fetchDataBtn.disabled = true;
                analyzeBtn.disabled = true;
                dataStatus.innerHTML = '<span class="info">認証後にデータ取得が可能になります</span>';
                dataStatus.className = 'status info';
            }
        });
        
        // ログイン
        loginBtn.addEventListener('click', async () => {
            try {
                authStatus.innerHTML = '<span class="loading">認証中...</span>';
                authStatus.className = 'status info';
                
                const provider = new firebase.auth.GoogleAuthProvider();
                provider.addScope('profile');
                provider.addScope('email');
                
                // ポップアップブロック対策
                const result = await auth.signInWithPopup(provider);
                console.log('認証成功:', result);
                
            } catch (error) {
                console.error('認証エラー詳細:', error);
                
                // エラー詳細を表示
                let errorMsg = '認証に失敗しました';
                if (error.code === 'auth/popup-blocked') {
                    errorMsg = 'ポップアップがブロックされました。ブラウザの設定を確認してください';
                } else if (error.code === 'auth/popup-closed-by-user') {
                    errorMsg = 'ログインがキャンセルされました';
                } else if (error.code === 'auth/unauthorized-domain') {
                    errorMsg = 'このドメインは認証に対応していません';
                } else if (error.message) {
                    errorMsg = `エラー: ${error.message}`;
                }
                
                authStatus.innerHTML = `<span class="error">❌ ${errorMsg}</span>`;
                authStatus.className = 'status error';
                
                // 代替手段として匿名認証を試行
                if (error.code === 'auth/unauthorized-domain' || error.code === 'auth/popup-blocked') {
                    setTimeout(() => {
                        authStatus.innerHTML = '<span class="info">匿名認証を試行中...</span>';
                        tryAnonymousAuth();
                    }, 2000);
                }
            }
        });
        
        // 匿名認証フォールバック
        async function tryAnonymousAuth() {
            try {
                await auth.signInAnonymously();
                authStatus.innerHTML = '<span class="success">✅ 匿名認証成功（機能制限あり）</span>';
                authStatus.className = 'status success';
            } catch (error) {
                console.error('匿名認証エラー:', error);
                authStatus.innerHTML = '<span class="error">❌ 認証に失敗しました。Firebase設定を確認してください</span>';
                authStatus.className = 'status error';
            }
        }
        
        // ログアウト
        logoutBtn.addEventListener('click', async () => {
            try {
                await auth.signOut();
                hideAllSections();
            } catch (error) {
                console.error('ログアウトエラー:', error);
            }
        });
        
        // データ取得
        fetchDataBtn.addEventListener('click', async () => {
            if (!userData) {
                dataStatus.innerHTML = '<span class="error">❌ 認証が必要です</span>';
                dataStatus.className = 'status error';
                return;
            }
            
            try {
                dataStatus.innerHTML = '<span class="loading">データを取得中...</span>';
                dataStatus.className = 'status info';
                
                // 認証済みユーザーでのアクセス
                console.log('現在のユーザー:', userData);
                console.log('アクセストークン:', await userData.getIdToken());
                
                const snapshot = await database.ref('weights').once('value');
                const data = snapshot.val();
                
                if (data) {
                    weightData = Object.keys(data).map(key => ({
                        id: key,
                        ...data[key]
                    }));
                    
                    dataStatus.innerHTML = `<span class="success">✅ ${weightData.length}件のデータを取得しました</span>`;
                    dataStatus.className = 'status success';
                    
                    displayBasicStatistics();
                    displayDataTable();
                    displayCharts();
                    analyzeBtn.disabled = false;
                    
                } else {
                    dataStatus.innerHTML = '<span class="error">❌ データが見つかりません</span>';
                    dataStatus.className = 'status error';
                }
                
            } catch (error) {
                console.error('データ取得エラー:', error);
                
                // 権限エラーの場合は詳細情報を表示
                if (error.code === 'PERMISSION_DENIED') {
                    dataStatus.innerHTML = `
                        <div class="error">
                            ❌ アクセス権限がありません<br>
                            <small>Firebase Database Rulesの設定を確認してください</small><br>
                            <small>または管理者にアクセス権限の付与を依頼してください</small>
                        </div>`;
                } else {
                    dataStatus.innerHTML = `<span class="error">❌ データ取得に失敗しました: ${error.message}</span>`;
                }
                dataStatus.className = 'status error';
                
                // デモデータでのテスト機能
                setTimeout(() => {
                    const useDemo = confirm('デモデータを使用してシステムの動作を確認しますか？');
                    if (useDemo) {
                        loadDemoData();
                    }
                }, 3000);
            }
        });
        
        // デモデータボタン
        demoDataBtn.addEventListener('click', () => {
            loadDemoData();
        });
        
        // 基本統計表示
        function displayBasicStatistics() {
            if (!weightData || weightData.length === 0) return;
            
            const weights = weightData.map(d => parseFloat(d.weight)).filter(w => !isNaN(w));
            if (weights.length === 0) return;
            
            const avgWeight = weights.reduce((a, b) => a + b, 0) / weights.length;
            const maxWeight = Math.max(...weights);
            const minWeight = Math.min(...weights);
            const weightRange = maxWeight - minWeight;
            
            const statGrid = document.getElementById('statGrid');
            statGrid.innerHTML = `
                <div class="stat-card">
                    <div class="stat-value">${avgWeight.toFixed(1)}</div>
                    <div class="stat-label">平均体重 (kg)</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${maxWeight.toFixed(1)}</div>
                    <div class="stat-label">最大体重 (kg)</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${minWeight.toFixed(1)}</div>
                    <div class="stat-label">最小体重 (kg)</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${weightRange.toFixed(1)}</div>
                    <div class="stat-label">体重変動幅 (kg)</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${weights.length}</div>
                    <div class="stat-label">測定回数</div>
                </div>
            `;
            
            document.getElementById('statisticsSection').style.display = 'block';
        }
        
        // データテーブル表示
        function displayDataTable() {
            if (!weightData || weightData.length === 0) return;
            
            const table = document.getElementById('dataTable');
            const headers = ['日付', '時刻', '体重', 'タイミング', 'メモ'];
            
            let html = '<tr>';
            headers.forEach(header => {
                html += `<th>${header}</th>`;
            });
            html += '</tr>';
            
            weightData.slice(0, 20).forEach(data => {
                html += `<tr>
                    <td>${data.date || '-'}</td>
                    <td>${data.time || '-'}</td>
                    <td>${data.weight || '-'}kg</td>
                    <td>${data.timing || '-'}</td>
                    <td>${data.memo || '-'}</td>
                </tr>`;
            });
            
            table.innerHTML = html;
            document.getElementById('dataSection').style.display = 'block';
        }
        
        // 機械学習分析
        analyzeBtn.addEventListener('click', async () => {
            if (!weightData || weightData.length < 5) {
                document.getElementById('mlResults').innerHTML = '<span class="error">❌ 分析には最低5件のデータが必要です</span>';
                document.getElementById('mlSection').style.display = 'block';
                return;
            }
            
            try {
                // 簡易機械学習分析（線形回帰）
                const weights = weightData.map(d => parseFloat(d.weight)).filter(w => !isNaN(w));
                const trend = calculateTrend(weights);
                const insights = generateInsights(weightData, trend);
                
                // 結果表示
                document.getElementById('mlResults').innerHTML = `
                    <div class="analysis-results">
                        <h4>📈 トレンド分析</h4>
                        <p><strong>体重変化傾向:</strong> ${trend.direction}</p>
                        <p><strong>変化率:</strong> ${trend.rate.toFixed(3)}kg/日</p>
                        <p><strong>予測精度:</strong> ${trend.accuracy}%</p>
                        
                        <h4>🔮 7日後予測</h4>
                        <p><strong>予測体重:</strong> ${trend.prediction.toFixed(1)}kg</p>
                        <p><strong>変化量:</strong> ${trend.change > 0 ? '+' : ''}${trend.change.toFixed(1)}kg</p>
                    </div>
                `;
                
                document.getElementById('insights').innerHTML = `
                    <h3>🤖 AI改善提案</h3>
                    <ul>
                        ${insights.map(insight => `<li>${insight}</li>`).join('')}
                    </ul>
                `;
                
                document.getElementById('mlSection').style.display = 'block';
                document.getElementById('insightsSection').style.display = 'block';
                
            } catch (error) {
                console.error('分析エラー:', error);
                document.getElementById('mlResults').innerHTML = '<span class="error">❌ 分析に失敗しました</span>';
                document.getElementById('mlSection').style.display = 'block';
            }
        });
        
        // トレンド計算（簡易線形回帰）
        function calculateTrend(weights) {
            const n = weights.length;
            const x = Array.from({length: n}, (_, i) => i);
            const y = weights;
            
            const sumX = x.reduce((a, b) => a + b, 0);
            const sumY = y.reduce((a, b) => a + b, 0);
            const sumXY = x.reduce((sum, xi, i) => sum + xi * y[i], 0);
            const sumX2 = x.reduce((sum, xi) => sum + xi * xi, 0);
            
            const slope = (n * sumXY - sumX * sumY) / (n * sumX2 - sumX * sumX);
            const intercept = (sumY - slope * sumX) / n;
            
            // R²計算
            const yMean = sumY / n;
            const totalSumSquares = y.reduce((sum, yi) => sum + Math.pow(yi - yMean, 2), 0);
            const residualSumSquares = y.reduce((sum, yi, i) => {
                const predicted = slope * x[i] + intercept;
                return sum + Math.pow(yi - predicted, 2);
            }, 0);
            const r2 = 1 - (residualSumSquares / totalSumSquares);
            
            const direction = slope > 0.05 ? '増加傾向' : slope < -0.05 ? '減少傾向' : '安定';
            const prediction = slope * (n + 7) + intercept;
            const change = prediction - weights[weights.length - 1];
            
            return {
                direction,
                rate: slope,
                accuracy: Math.round(r2 * 100),
                prediction,
                change
            };
        }
        
        // AI改善提案生成
        function generateInsights(data, trend) {
            const insights = [];
            
            // トレンドベースの提案
            if (trend.direction === '増加傾向') {
                insights.push('⚠️ 体重が増加傾向にあります。食事内容の見直しや運動量の増加を検討しましょう');
                insights.push('📊 カロリー摂取量の記録を開始することをお勧めします');
            } else if (trend.direction === '減少傾向') {
                insights.push('✅ 体重減少が順調です。現在の生活習慣を維持しましょう');
                insights.push('💪 筋力維持のための適度な運動も併せて行いましょう');
            } else {
                insights.push('📈 体重は安定しています。健康的な状態を維持できています');
            }
            
            // 測定頻度の提案
            const uniqueDates = new Set(data.map(d => d.date)).size;
            const totalDays = Math.ceil((new Date() - new Date(data[0].date)) / (1000 * 60 * 60 * 24));
            const frequency = uniqueDates / totalDays;
            
            if (frequency < 0.5) {
                insights.push('📝 測定頻度を上げることで、より正確な体重管理が可能になります');
            }
            
            // 曜日パターンの分析
            const dayOfWeekData = {};
            data.forEach(d => {
                if (d.date) {
                    const day = new Date(d.date).getDay();
                    if (!dayOfWeekData[day]) dayOfWeekData[day] = [];
                    dayOfWeekData[day].push(parseFloat(d.weight));
                }
            });
            
            const dayAverages = Object.keys(dayOfWeekData).map(day => ({
                day: parseInt(day),
                avg: dayOfWeekData[day].reduce((a, b) => a + b, 0) / dayOfWeekData[day].length
            }));
            
            if (dayAverages.length >= 3) {
                const maxDay = dayAverages.reduce((max, curr) => curr.avg > max.avg ? curr : max);
                const minDay = dayAverages.reduce((min, curr) => curr.avg < min.avg ? curr : min);
                const dayNames = ['日', '月', '火', '水', '木', '金', '土'];
                
                insights.push(`📅 ${dayNames[maxDay.day]}曜日に体重が最も重く、${dayNames[minDay.day]}曜日に最も軽い傾向があります`);
            }
            
            return insights;
        }
        
        // グラフ表示
        function displayCharts() {
            if (!weightData || weightData.length === 0) return;
            
            // データ準備
            const sortedData = [...weightData].sort((a, b) => new Date(a.date) - new Date(b.date));
            const labels = sortedData.map(d => d.date);
            const weights = sortedData.map(d => parseFloat(d.weight));
            
            // 体重推移グラフ
            const ctx1 = document.getElementById('weightChart').getContext('2d');
            new Chart(ctx1, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: '体重 (kg)',
                        data: weights,
                        borderColor: 'rgb(102, 126, 234)',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        tension: 0.2,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: '体重推移グラフ'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            title: {
                                display: true,
                                text: '体重 (kg)'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: '日付'
                            }
                        }
                    }
                }
            });
            
            // 曜日別平均グラフ
            const weeklyData = {};
            sortedData.forEach(d => {
                if (d.date) {
                    const day = new Date(d.date).getDay();
                    if (!weeklyData[day]) weeklyData[day] = [];
                    weeklyData[day].push(parseFloat(d.weight));
                }
            });
            
            const weeklyLabels = ['日', '月', '火', '水', '木', '金', '土'];
            const weeklyAverages = weeklyLabels.map((_, i) => {
                const dayData = weeklyData[i];
                return dayData ? dayData.reduce((a, b) => a + b, 0) / dayData.length : 0;
            });
            
            const ctx2 = document.getElementById('weeklyChart').getContext('2d');
            new Chart(ctx2, {
                type: 'bar',
                data: {
                    labels: weeklyLabels,
                    datasets: [{
                        label: '平均体重 (kg)',
                        data: weeklyAverages,
                        backgroundColor: [
                            'rgba(255, 99, 132, 0.8)',
                            'rgba(54, 162, 235, 0.8)',
                            'rgba(255, 205, 86, 0.8)',
                            'rgba(75, 192, 192, 0.8)',
                            'rgba(153, 102, 255, 0.8)',
                            'rgba(255, 159, 64, 0.8)',
                            'rgba(199, 199, 199, 0.8)'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: '曜日別平均体重'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            title: {
                                display: true,
                                text: '平均体重 (kg)'
                            }
                        }
                    }
                }
            });
            
            document.getElementById('chartsSection').style.display = 'block';
        }
        
        // デモデータ読み込み
        function loadDemoData() {
            console.log('デモデータを読み込み中...');
            
            // サンプル体重データ生成
            const today = new Date();
            weightData = [];
            
            for (let i = 30; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(today.getDate() - i);
                
                // 基準体重に変動を加える
                const baseWeight = 72.0;
                const trend = -0.02 * i; // 緩やかな減少傾向
                const dailyVariation = (Math.random() - 0.5) * 1.0; // ±0.5kgの日次変動
                const weight = baseWeight + trend + dailyVariation;
                
                const timings = ['morning', 'toilet', 'before_bath', 'after_bath'];
                const timing = timings[Math.floor(Math.random() * timings.length)];
                
                weightData.push({
                    id: `demo_${i}`,
                    date: date.toISOString().split('T')[0],
                    time: '08:00',
                    weight: weight.toFixed(1),
                    timing: timing,
                    memo: 'デモデータ',
                    timestamp: date.getTime()
                });
            }
            
            dataStatus.innerHTML = `<span class="success">✅ デモデータ ${weightData.length}件を読み込みました</span>`;
            dataStatus.className = 'status success';
            
            displayBasicStatistics();
            displayDataTable();
            displayCharts();
            analyzeBtn.disabled = false;
            
            console.log('デモデータ読み込み完了:', weightData);
        }
        
        // セクション非表示
        function hideAllSections() {
            document.getElementById('statisticsSection').style.display = 'none';
            document.getElementById('chartsSection').style.display = 'none';
            document.getElementById('mlSection').style.display = 'none';
            document.getElementById('insightsSection').style.display = 'none';
            document.getElementById('dataSection').style.display = 'none';
        }
    </script>
</body>
</html>